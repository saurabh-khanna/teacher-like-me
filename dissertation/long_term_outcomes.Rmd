---
title: "Long Term Outcomes for Caste Paper"
date: "`r Sys.Date()`"
output:
  pdf_document:
    extra_dependencies: ["dcolumn", "booktabs", "caption", "float"]
    toc: yes
    toc_depth: 6
    keep_tex: yes
    number_sections: true
---

\captionsetup[table]{labelformat=empty}


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F, fig.retina = 4)
```

```{r message=FALSE, warning=FALSE}
# Libraries
pacman::p_load(haven, estimatr, extrafont, texreg, janitor, xtable, papeR, tidyverse, compareGroups, Hmisc, skimr)
```

\newpage


```{r}
# Student Data
df_stu <- 
  read_dta(here::here("data", "stu_admin_all_latest.dta")) %>%
  left_join(read_dta(here::here("data/reservation_new.dta")), by = "stdid") %>% 
  mutate(
    reservation = dplyr::recode(reservation, "Non-reservation" = 0L, "Reservation" = 1L, .default = NA_integer_),
  )


df <- 
  read_dta(here::here("data", "all_appended.dta")) %>% 
  distinct(stdid, course_name, facid, .keep_all = T) %>% 
  left_join(
    df_stu %>% 
      select(stdid, classid, department_id, reservation, caste, ea_stud_group_criteria, grade),
    by = "stdid"
  ) %>%
  filter(ea_stud_group_criteria == 2, grade == 2) %>%
  left_join(read_dta(here::here("data/fac_covariates.dta")), by = "facid")


# fixing for course cleaning done by sk in sep 2021
df <-
  df %>% 
  left_join(
    read_dta(here::here("data/students_clean.dta")),
    by = c("department_id", "course_name")
  ) %>% 
  mutate(
    course_name = if_else(!is.na(course_clean_sk), course_clean_sk, course_name)
  ) %>%
  distinct(stdid, course_name, facid, .keep_all = T)
```



```{r}
# grade data after veda's work
df_grades <-
  read_dta(here::here("data/30jan2022/df_gradefac.dta")) %>% 
  filter(facid != "") %>%
  left_join(df_stu %>% select(stdid, univcode, department_id, reservation, caste, b_i_jeemain_score, b_math_g1_score, b_physics_g1_score, e_math_g3_score, e_physics_g3_score, b_ct_score, b_ql_score, e_ct_score, e_ql_score, b_rr_score, e_rr_score, e_attend_grad_school, e_college_satisfied, e_dropped_out, e_switchmajor, e_math_attend = e_univtimeuse_1, e_physics_attend = e_univtimeuse_4, e_hot_attend = e_univexpr_55, e_talkprof_research, e_workprof_research, e_received_tutoring, e_growth_mindset_z), by = "stdid") %>%
  left_join(read_dta(here::here("data/controls.dta")), by = "stdid") %>%
  left_join(read_dta(here::here("data/fac_covariates.dta")), by = "facid") %>% 
  arrange(department_id, course_name, course_grade_clean) %>% 
  group_by(department_id, course_name) %>% 
  mutate(
    course_rank = (scale(course_grade_clean) %>% pnorm() * 100) %>% as.vector
  ) %>% 
  ungroup() %>%
  mutate(
    father_college = if_else(father_ed_ind > 3 & !is.na(father_ed_ind), 1L, 0L),
    father_college = if_else(is.na(father_ed_ind), NA_integer_, father_college),
    mother_college = if_else(mother_ed_ind > 3 & !is.na(mother_ed_ind), 1L, 0L),
    mother_college = if_else(is.na(mother_ed_ind), NA_integer_, mother_college),
    ses = ses %>% as.integer(),
  ) %>%
  relocate(department_id, course_name, stdid, course_rank) %>% 
  rename(reservation_stu = reservation)

rm(df)

# df_grades %>% 
#   select(course_name, facid, fac_reservation) %>%
#   inner_join(readxl::read_xlsx(here::here("data/introductory_courses.xlsx"))) %>% 
#   group_by(facid, fac_reservation) %>% 
#   summarise(introductory = mean(introductory, na.rm = T)) %>% 
#   ungroup() %>%
#   compareGroups(fac_reservation ~ introductory, data = ., include.label = F) %>%
#   createTable(show.all = F)

# df_grades %>% 
  # distinct(univcode) %>% 
  # inner_join(read_dta(here::here("data/univnames.dta"))) %>% 
  # writexl::write_xlsx(here::here("data/univnames.xlsx"))
```


# Test scores

## Math and Physics

```{r}
df_math <-
  df_grades %>%
  filter(subject == "math") %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>% 
  drop_na(e_math_g3_score) %>%
  group_by(stdid, subject, reservation_stu, female, father_college, mother_college, b_math_g1_score, e_math_g3_score, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup() %>% 
  mutate(
    e_g3_score = scale(e_math_g3_score) %>% as.vector,
    b_g1_score = scale(b_math_g1_score) %>% as.vector,
  ) %>% 
  relocate(stdid, reservation_fac, e_g3_score, b_g1_score, e_math_g3_score, b_math_g1_score)

df_physics <-
  df_grades %>%
  filter(subject == "physics") %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>% 
  drop_na(e_physics_g3_score) %>%
  group_by(stdid, subject, reservation_stu, female, father_college, mother_college, b_physics_g1_score, e_physics_g3_score, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>%
  ungroup() %>% 
  mutate(
    e_g3_score = scale(e_physics_g3_score) %>% as.vector,
    b_g1_score = scale(b_physics_g1_score) %>% as.vector,
  ) %>% 
  relocate(stdid, reservation_fac, e_g3_score, b_g1_score, e_physics_g3_score, b_physics_g1_score)

df_temp <-
  bind_rows(df_math, df_physics) %>% 
  arrange(stdid, subject) %>% 
  relocate(stdid, subject) %>% 
  mutate(subject = as_factor(str_to_title(subject)))

rm(df_math, df_physics)
```


The dependent variables are standardized test scores (mean 0). All models include baseline score controls and department fixed effects.

```{r, results='asis'}
lm1 <-
  df_temp %>%
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_g3_score ~ reservation_fac + subject + b_g1_score, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm2 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_g3_score ~ reservation_fac + subject + b_g1_score + reservation_stu + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm3 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_g3_score ~ reservation_fac + subject + b_g1_score + reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm4 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_g3_score ~ reservation_fac * reservation_stu + subject + b_g1_score + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

knitreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = F, dcolumn = T, booktabs = T, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(miss_age)|(Intercept)")
```

\newpage

## CT/QL and TORR

```{r}
df_ct <-
  df_grades %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>% 
  drop_na(e_ct_score) %>%
  group_by(stdid, reservation_stu, female, father_college, mother_college, b_ct_score, e_ct_score, b_rr_score, e_rr_score, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup() %>% 
  mutate(
    e_ct_score = scale(e_ct_score) %>% as.vector,
    b_ct_score = scale(b_ct_score) %>% as.vector,
    e_rr_score = scale(e_rr_score) %>% as.vector,
    b_rr_score = scale(b_rr_score) %>% as.vector,
  ) %>%
  pivot_longer(cols = c(e_ct_score, e_rr_score, b_ct_score, b_rr_score)) %>% 
  mutate(
    subject = str_sub(name, 3, 4) %>% str_to_upper(),
    name = if_else(str_detect(name, "^b_"), "b_score", "e_score")
  ) %>% 
  pivot_wider(names_from = name, values_from = value) %>% 
  relocate(stdid, subject, e_score, b_score)

df_ql <-
  df_grades %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>% 
  drop_na(e_ql_score) %>%
  group_by(stdid, reservation_stu, female, father_college, mother_college, b_ql_score, e_ql_score, b_rr_score, e_rr_score, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup() %>% 
  mutate(
    e_ql_score = scale(e_ql_score) %>% as.vector,
    b_ql_score = scale(b_ql_score) %>% as.vector,
    e_rr_score = scale(e_rr_score) %>% as.vector,
    b_rr_score = scale(b_rr_score) %>% as.vector,
  ) %>%
  pivot_longer(cols = c(e_ql_score, e_rr_score, b_ql_score, b_rr_score)) %>% 
  mutate(
    subject = str_sub(name, 3, 4) %>% str_to_upper(),
    name = if_else(str_detect(name, "^b_"), "b_score", "e_score")
  ) %>% 
  pivot_wider(names_from = name, values_from = value) %>% 
  relocate(stdid, subject, e_score, b_score)

df_temp <-
  bind_rows(df_ct, df_ql) %>% 
  arrange(stdid, subject) %>% 
  mutate(subject = fct_infreq(subject)) %>% 
  relocate(department_id, stdid, subject, e_score, b_score, reservation_fac, contains("fac_"))

rm(df_ct, df_ql)

#df_temp %>% rename(fac_reservation = reservation_fac) %>% write_dta(here::here("trash.dta"))

# df_temp %>% 
#   ggplot(aes(fac_degree_college_elite)) +
#   geom_histogram(alpha = 0.9) +
#   theme_minimal() +
#   labs(x = "fac_reservation")
# 
# df_temp %>% 
#   ggplot(aes(e_score)) +
#   geom_histogram(alpha = 0.9, bins = 18) +
#   theme_minimal() +
#   facet_wrap(vars(subject))
```


The dependent variables are standardized test scores (mean 0). All models include baseline score controls and department fixed effects.

```{r, results='asis'}
lm1 <-
  df_temp %>%
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_score ~ reservation_fac + subject + b_score, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm2 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_score ~ reservation_fac + subject + b_score + reservation_stu + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm3 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_score ~ reservation_fac + subject + b_score + reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm4 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_score ~ reservation_fac * reservation_stu + subject + b_score + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)


knitreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = F, dcolumn = T, booktabs = T, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(miss_age)|(Intercept)")
```

\newpage

# Hours attending classes

The dependent variable is average daily hours attending classes (0-15) for HOT (all subjects), for math, or for physics. Mean of this variable is 6.17.

```{r}
df_math <-
  df_grades %>%
  filter(subject == "math") %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>% 
  rename(e_attend = e_math_attend) %>% 
  drop_na(e_attend) %>%
  group_by(stdid, subject, reservation_stu, female, father_college, mother_college, e_attend, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup() %>% 
  relocate(stdid, reservation_fac, e_attend)

df_physics <-
  df_grades %>%
  filter(subject == "physics") %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>% 
  rename(e_attend = e_physics_attend) %>% 
  drop_na(e_attend) %>%
  group_by(stdid, subject, reservation_stu, female, father_college, mother_college, e_attend, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup() %>% 
  relocate(stdid, reservation_fac, e_attend)

df_hot <-
  df_grades %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>% 
  rename(e_attend = e_hot_attend) %>%
  drop_na(e_attend) %>%
  group_by(stdid, reservation_stu, female, father_college, mother_college, e_attend, age, miss_age, department_id) %>%
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup() %>%
  mutate(subject = "HOT") %>% 
  relocate(stdid, reservation_fac, e_attend, subject)


df_temp <-
  bind_rows(df_math, df_physics, df_hot) %>% 
  arrange(stdid, subject) %>% 
  relocate(stdid, subject) %>% 
  mutate(subject = as_factor(str_to_title(subject)) %>% fct_relevel(sort))

rm(df_math, df_physics, df_hot)
```


All models include department fixed effects.

```{r, results='asis'}
lm1 <-
  df_temp %>%
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_attend ~ reservation_fac + subject, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm2 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_attend ~ reservation_fac + subject + reservation_stu + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm3 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_attend ~ reservation_fac + subject + reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm4 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_attend ~ reservation_fac * reservation_stu + subject + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

knitreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = F, dcolumn = T, booktabs = T, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(miss_age)|(Intercept)")
```

\newpage

# College satisfaction

The dependent variable is college satisfaction (0/1). Mean is 0.70. All models include department fixed effects.

```{r, results='asis'}
df_temp <-
  df_grades %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>%
  group_by(stdid, e_college_satisfied, reservation_stu, female, father_college, mother_college, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup()

lm1 <-
  df_temp %>%
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_college_satisfied ~ reservation_fac, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm2 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_college_satisfied ~ reservation_fac + reservation_stu + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm3 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_college_satisfied ~ reservation_fac + reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm4 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_college_satisfied ~ reservation_fac * reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

knitreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = F, dcolumn = T, booktabs = T, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(miss_age)|(Intercept)")
```


\newpage

# Plans for grad school

The dependent variable is plans for grad school (0/1). Mean is 0.61. All models include department fixed effects.

```{r, results='asis'}
df_temp <-
  df_grades %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>%
  group_by(stdid, e_attend_grad_school, reservation_stu, female, father_college, mother_college, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup()

lm1 <-
  df_temp %>%
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_attend_grad_school ~ reservation_fac, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm2 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_attend_grad_school ~ reservation_fac + reservation_stu + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm3 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_attend_grad_school ~ reservation_fac + reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm4 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_attend_grad_school ~ reservation_fac * reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

knitreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = F, dcolumn = T, booktabs = T, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(miss_age)|(Intercept)")
```

\newpage

# College dropout

The dependent variable is college dropout (0/1). Mean is 0.01. All models include department fixed effects.

```{r, results='asis'}
df_temp <-
  df_grades %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>%
  group_by(stdid, e_dropped_out, reservation_stu, female, father_college, mother_college, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup()

lm1 <-
  df_temp %>%
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_dropped_out ~ reservation_fac, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm2 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_dropped_out ~ reservation_fac + reservation_stu + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm3 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_dropped_out ~ reservation_fac + reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm4 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_dropped_out ~ reservation_fac * reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

knitreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = F, dcolumn = T, booktabs = T, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(miss_age)|(Intercept)")
```

```{r, eval=F}
# df_temp %>% 
#   drop_na(female, father_college, mother_college) %>% 
#   relocate(stdid, department_id, e_dropped_out, reservation_fac) %>%
#   arrange(stdid, e_dropped_out) %>%
#   write_dta("~/Desktop/table5.dta")
```


\newpage


# Switch major

The dependent variable is switching major (0/1). Mean is 0 (i.e., no sampled student switches major). All models include department fixed effects.

```{r, results='asis'}
df_temp <-
  df_grades %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>%
  group_by(stdid, e_switchmajor, reservation_stu, female, father_college, mother_college, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup()

lm1 <-
  df_temp %>%
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_switchmajor ~ reservation_fac, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm2 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_switchmajor ~ reservation_fac + reservation_stu + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm3 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_switchmajor ~ reservation_fac + reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm4 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_switchmajor ~ reservation_fac * reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

knitreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = F, dcolumn = T, booktabs = T, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(miss_age)|(Intercept)")
```


\newpage



# Closed or open mindset

The dependent variable growth mindset is created by applying the Anderson index to 3 survey items on intelligence beliefs across the national sample. This variable is then turned into a z-score before use in below regression models. Mean is -0.1 (should I standardize within our 12 college sample?).

```{r, results='asis'}
df_temp <-
  df_grades %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>%
  group_by(stdid, e_growth_mindset_z, reservation_stu, female, father_college, mother_college, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup()

lm1 <-
  df_temp %>%
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_growth_mindset_z ~ reservation_fac, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm2 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_growth_mindset_z ~ reservation_fac + reservation_stu + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm3 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_growth_mindset_z ~ reservation_fac + reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm4 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_growth_mindset_z ~ reservation_fac * reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

knitreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = F, dcolumn = T, booktabs = T, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(miss_age)|(Intercept)")
```


\newpage

# Receiving Tutoring

## Old results (HOT + Math)

Dependent variable is receiving paid or unpaid tutoring (0/1). Mean is 0.736. We combine data from HOT and Math surveys and use survey type as a control in the regression models.

```{r}
df_math <-
  df_grades %>%
  filter(subject == "math") %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>% 
  drop_na(e_math_g3_score, e_received_tutoring) %>%
  group_by(stdid, reservation_stu, female, father_college, mother_college, e_received_tutoring, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup() %>% 
  mutate(survey = "math") %>%
  relocate(stdid, reservation_fac, e_received_tutoring)

df_hot <-
  df_grades %>%
  filter(!(is.na(e_ct_score) & is.na(e_ql_score))) %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>% 
  drop_na(e_received_tutoring) %>%
  group_by(stdid, reservation_stu, female, father_college, mother_college, e_received_tutoring, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup() %>% 
  mutate(survey = "hot") %>%
  relocate(stdid, reservation_fac, e_received_tutoring)

df_temp <-
  bind_rows(df_math, df_hot) %>% 
  arrange(stdid, survey) %>% 
  relocate(stdid, survey) %>% 
  mutate(survey = as_factor(str_to_title(survey)))

rm(df_math, df_hot)
```


All models include department fixed effects.

```{r, results='asis'}
lm1 <-
  df_temp %>%
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_received_tutoring ~ reservation_fac + survey, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm2 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_received_tutoring ~ reservation_fac + survey + reservation_stu + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm3 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_received_tutoring ~ reservation_fac + survey + reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm4 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_received_tutoring ~ reservation_fac * reservation_stu + survey + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

knitreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = F, dcolumn = T, booktabs = T, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(miss_age)|(Intercept)")
```


\newpage

## New results (HOT only)

Dependent variable is receiving paid or unpaid tutoring (0/1). Mean is 0.72. We use data from HOT survey only in the regression models.

```{r}
df_temp <-
  df_grades %>%
  filter(!(is.na(e_ct_score) & is.na(e_ql_score))) %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>% 
  drop_na(e_received_tutoring) %>%
  group_by(stdid, reservation_stu, female, father_college, mother_college, e_received_tutoring, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup() %>% 
  mutate(survey = "hot") %>%
  relocate(stdid, reservation_fac, e_received_tutoring)
```

All models include department fixed effects.

```{r, results='asis'}
lm1 <-
  df_temp %>%
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_received_tutoring ~ reservation_fac, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm2 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_received_tutoring ~ reservation_fac + reservation_stu + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm3 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_received_tutoring ~ reservation_fac + reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm4 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_received_tutoring ~ reservation_fac * reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

knitreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = F, dcolumn = T, booktabs = T, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(miss_age)|(Intercept)")
```


\newpage

# Working with faculty on research

Dependent variable is working with faculty on their research (0/1). Mean is 0.21. We combine data from HOT and Math surveys and use survey type as a control in the regression models.

```{r}
df_math <-
  df_grades %>%
  filter(subject == "math") %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>% 
  drop_na(e_math_g3_score, e_workprof_research) %>%
  group_by(stdid, reservation_stu, female, father_college, mother_college, e_workprof_research, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup() %>% 
  mutate(survey = "math") %>%
  relocate(stdid, reservation_fac, e_workprof_research)

df_hot <-
  df_grades %>%
  filter(!(is.na(e_ct_score) & is.na(e_ql_score))) %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
  ) %>% 
  drop_na(e_workprof_research) %>%
  group_by(stdid, reservation_stu, female, father_college, mother_college, e_workprof_research, age, miss_age, department_id) %>% 
  summarise(
    reservation_fac = mean(reservation_fac, na.rm = T),
    fac_associate_professor = mean(fac_associate_professor, na.rm = T),
    fac_professor = mean(fac_professor, na.rm = T),
    fac_yearsinhighed = mean(fac_yearsinhighed, na.rm = T),
    fac_highest_degree_phd = mean(fac_highest_degree_phd, na.rm = T),
    fac_highest_degree_phd_in_prog = mean(fac_highest_degree_phd_in_prog, na.rm = T),
    fac_degree_college_elite = mean(fac_degree_college_elite, na.rm = T),
    fac_female = mean(fac_female, na.rm = T),
  ) %>% 
  ungroup() %>% 
  mutate(survey = "hot") %>%
  relocate(stdid, reservation_fac, e_workprof_research)

df_temp <-
  bind_rows(df_math, df_hot) %>% 
  arrange(stdid, survey) %>% 
  relocate(stdid, survey) %>% 
  mutate(survey = as_factor(str_to_title(survey)))

rm(df_math, df_hot)
```


All models include department fixed effects.

```{r, results='asis'}
lm1 <-
  df_temp %>%
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_workprof_research ~ reservation_fac + survey, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm2 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_workprof_research ~ reservation_fac + survey + reservation_stu + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm3 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_workprof_research ~ reservation_fac + survey + reservation_stu + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

lm4 <-
  df_temp %>% 
  drop_na(female, father_college, mother_college) %>%
  lm_robust(e_workprof_research ~ reservation_fac * reservation_stu + survey + female + age + miss_age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ department_id)

knitreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = F, dcolumn = T, booktabs = T, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(miss_age)|(Intercept)")
```



\newpage

# Faculty and Student Characteristics, Faculty Differences, and Balance Checks

Baselint test scores (Math, Physics, CT, QL, RR) are standardized to have a mean 0 and and sd 1.

```{=latex}
\begin{table}[H]
  \centering
  \begin{tabular}{@{}lllllll@{}}
    \toprule
    \multicolumn{1}{c}{}  &  & \multicolumn{5}{c}{Panel A: Faculty}  \\ \cmidrule(l){3-7}
                                      &           &               &             &           &                             &             \\
    \textbf{Faculty characteristics}  & \textbf{} & \textbf{Mean} & \textbf{SD} & \textbf{} & \textbf{Res-NonRes faculty} & \textbf{SE} \\
                                      &           &               &             &           &                             &             \\
    Reservation status                &           & 0.39          & 0.49        &           & 1.000                       &             \\
    Assistant Professor               &           & 0.72          & 0.45        &           & 0.055                       & 0.061       \\
    Associate Professor               &           & 0.18          & 0.38        &           & 0.018                       & 0.043       \\
    Professor                         &           & 0.08          & 0.27        &           & -0.071                      & 0.043       \\
    Experience in years               &           & 9.96          & 6.51        &           & -1.391*                     & 0.793       \\
    Highest degree is Masters         &           & 0.51          & 0.50        &           & 0.147**                     & 0.074       \\
    Highest degree is PhD             &           & 0.32          & 0.47        &           & -0.133***                   & 0.041       \\
    Highest degree is PhD in progress &           & 0.15          & 0.36        &           & -0.023                      & 0.068       \\
    Degree college elite              &           & 0.32          & 0.47        &           & -0.109*                     & 0.063       \\
    Female                            &           & 0.33          & 0.47        &           & -0.008                      & 0.076       \\
                                      &           &               &             &           &                             &             \\ \cmidrule(l){3-7}
    &  & \multicolumn{5}{c}{Panel B: Students} \\ \cmidrule(l){3-7}
                                      &           &               &             &           &                             &             \\
    \textbf{Student characteristics}  & \textbf{} & \textbf{Mean} & \textbf{SD} & \textbf{} & \textbf{Res-NonRes faculty} & \textbf{SE} \\
                                      &           &               &             &           &                             &             \\
    Reservation status                &           & 0.54          & 0.50        &           & -0.008                      & 0.010       \\
    Female                            &           & 0.44          & 0.50        &           & -0.002                      & 0.007       \\
    Age                               &           & 17.72         & 0.80        &           & 0.001                       & 0.011       \\
    Father college                    &           & 0.50          & 0.50        &           & 0.005                       & 0.010       \\
    Mother college                    &           & 0.35          & 0.48        &           & 0.018**                     & 0.008       \\ 
    Baseline Math score               &           & 0.00          & 1.00        &           & 0.001                       & 0.024       \\
    Baseline Physics score            &           & 0.00          & 1.00        &           & -0.010                      & 0.025       \\
    Baseline HOT score                &           & 0.00          & 1.00        &           & 0.069***                    & 0.022       \\
    JEE Main score                    &           & 68.14         & 44.33       &           & 0.971                       & 0.920       \\
    Took JEE Main                     &           & 0.67          & 0.47        &           & 0.004                       & 0.008       \\ \bottomrule
  \end{tabular}
\end{table}
```

\newpage

# Teaching Introductory Courses

Sample restricted to first cohort of students and their instructors in the 12-college sample.

```{r, eval=F}
read_dta(here::here("data/30jan2022/semesters.dta")) %>% 
  inner_join(df_grades %>% distinct(facid), by = "facid") %>%
  drop_na(reservation_fac, semester) %>% 
  filter(semester <= 4) %>% 
  tabyl(reservation_fac)
```

```{=latex}
\begin{table}[H]
\centering
\begin{tabular}{@{}lll@{}}
\toprule
                & Reservation category \% & N     \\ \midrule
First semester  & 32.89\%                 & 13560 \\
Second semester & 39.64\%                 & 12323 \\
Third semester  & 41.36\%                 & 14060 \\
Fourth semester & 44.76\%                 & 11855 \\\\
Total           & 39.51\%                 & 51798 \\ \bottomrule
\end{tabular}%
\caption{}
\label{tab:semester-table}
\end{table}
```

\newpage

# International Publications per year (SCI + EI + SSCI)

These regressions use department-level sampling weights, and are run at the faculty level for the national sample (50 colleges). All specifications include college and department fixed effects. Dependent variable mean is 0.62.

```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{4.3} D{.}{.}{4.5} D{.}{.}{4.5} D{.}{.}{4.5}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} \\
\midrule
Reservation faculty               & -0.07  & -0.01      & -0.01      & -0.01      \\
                                  & (0.05) & (0.05)     & (0.05)     & (0.05)     \\
Associate professor               &        & 0.21^{***} & 0.14^{*}   & 0.15^{**}  \\
                                  &        & (0.08)     & (0.07)     & (0.07)     \\
Professor                         &        & 1.10^{***} & 0.93^{***} & 0.92^{***} \\
                                  &        & (0.26)     & (0.27)     & (0.27)     \\
Experience in years               &        & 0.01^{*}   & 0.01       & 0.01       \\
                                  &        & (0.01)     & (0.01)     & (0.01)     \\
Highest degree is PhD             &        &            & 0.23^{***} & 0.23^{***} \\
                                  &        &            & (0.09)     & (0.08)     \\
Highest degree is PhD in progress &        &            & -0.00      & -0.00      \\
                                  &        &            & (0.04)     & (0.04)     \\
Degree college elite              &        &            & 0.08       & 0.08       \\
                                  &        &            & (0.06)     & (0.06)     \\
Female                            &        &            &            & -0.07^{**} \\
                                  &        &            &            & (0.03)     \\
\midrule
Num. obs.                         & 2535   & 2535       & 2533       & 2532       \\
\bottomrule
\multicolumn{5}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{}
\label{table:coefficients}
\end{center}
\end{table}
```


\newpage

# Funding

These regressions use department-level sampling weights, and are run at the faculty level for the national sample (50 colleges). All specifications include college and department fixed effects.

## Government funding (0/1)

Dependent variable mean is 0.097.

```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{4.3} D{.}{.}{4.5} D{.}{.}{4.5} D{.}{.}{4.5}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} \\
\midrule
Reservation faculty               & -0.01  & 0.00       & 0.00       & 0.00       \\
                                  & (0.01) & (0.01)     & (0.01)     & (0.01)     \\
Associate professor               &        & 0.03       & 0.02       & 0.02       \\
                                  &        & (0.02)     & (0.02)     & (0.02)     \\
Professor                         &        & 0.15^{***} & 0.14^{***} & 0.13^{***} \\
                                  &        & (0.04)     & (0.04)     & (0.04)     \\
Experience in years               &        & 0.00       & 0.00       & 0.00       \\
                                  &        & (0.00)     & (0.00)     & (0.00)     \\
Highest degree is PhD             &        &            & 0.02       & 0.02       \\
                                  &        &            & (0.02)     & (0.02)     \\
Highest degree is PhD in progress &        &            & -0.02^{**} & -0.02^{**} \\
                                  &        &            & (0.01)     & (0.01)     \\
Degree college elite              &        &            & -0.01      & -0.01      \\
                                  &        &            & (0.01)     & (0.01)     \\
Female                            &        &            &            & -0.01      \\
                                  &        &            &            & (0.01)     \\
\midrule
Num. obs.                         & 2691   & 2685       & 2680       & 2679       \\
\bottomrule
\multicolumn{5}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{}
\label{table:coefficients}
\end{center}
\end{table}
```


\newpage

## Private funding (0/1)

Dependent variable mean is 0.029.

```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{4.3} D{.}{.}{4.3} D{.}{.}{4.4} D{.}{.}{4.5}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} \\
\midrule
Reservation faculty               & -0.00  & -0.00  & -0.00     & -0.00       \\
                                  & (0.01) & (0.01) & (0.01)    & (0.01)      \\
Associate professor               &        & -0.00  & -0.01     & -0.01       \\
                                  &        & (0.01) & (0.01)    & (0.01)      \\
Professor                         &        & 0.02   & 0.00      & 0.00        \\
                                  &        & (0.02) & (0.02)    & (0.02)      \\
Experience in years               &        & 0.00   & 0.00      & 0.00        \\
                                  &        & (0.00) & (0.00)    & (0.00)      \\
Highest degree is PhD             &        &        & 0.03^{**} & 0.03^{**}   \\
                                  &        &        & (0.01)    & (0.01)      \\
Highest degree is PhD in progress &        &        & 0.01      & 0.01        \\
                                  &        &        & (0.01)    & (0.01)      \\
Degree college elite              &        &        & -0.01^{*} & -0.01^{*}   \\
                                  &        &        & (0.01)    & (0.01)      \\
Female                            &        &        &           & -0.02^{***} \\
                                  &        &        &           & (0.01)      \\
\midrule
Num. obs.                         & 2691   & 2685   & 2680      & 2679        \\
\bottomrule
\multicolumn{5}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{}
\label{table:coefficients}
\end{center}
\end{table}
```

\newpage

# New regression for appendix

Dependent variables:

- I: Annual publications
- II: Annual international publications
- III: Annual international SCI/EI/SSCI publications
- IV: Funding received
- V: Admin position held


```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{3.5} D{.}{.}{3.5} D{.}{.}{3.4} D{.}{.}{3.4} D{.}{.}{3.5}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} & \multicolumn{1}{c}{V} \\
\midrule
Reservation faculty               & -0.76^{**} & -0.38^{***} & -0.25^{**} & -0.02     & -0.01      \\
                                  & (0.31)     & (0.13)      & (0.11)     & (0.02)    & (0.05)     \\
Associate professor               & 1.51^{***} & 0.55^{***}  & 0.32^{**}  & 0.03      & 0.05       \\
                                  & (0.49)     & (0.18)      & (0.15)     & (0.03)    & (0.08)     \\
Professor                         & 4.76^{***} & 1.97^{***}  & 1.38^{**}  & -0.01     & 0.18       \\
                                  & (1.35)     & (0.68)      & (0.58)     & (0.05)    & (0.13)     \\
Experience in years               & -0.00      & -0.00       & 0.01       & -0.00     & 0.02^{***} \\
                                  & (0.04)     & (0.02)      & (0.01)     & (0.00)    & (0.00)     \\
Highest degree is PhD             & 0.89^{*}   & 0.37        & 0.14       & 0.10^{**} & 0.10       \\
                                  & (0.53)     & (0.27)      & (0.23)     & (0.05)    & (0.08)     \\
Highest degree is PhD in progress & 0.08       & 0.09        & -0.07      & 0.01      & 0.02       \\
                                  & (0.31)     & (0.15)      & (0.09)     & (0.02)    & (0.06)     \\
Degree college elite              & -0.18      & -0.15       & -0.10      & -0.02     & -0.08      \\
                                  & (0.35)     & (0.16)      & (0.13)     & (0.02)    & (0.05)     \\
Female                            & -0.10      & -0.13       & 0.04       & 0.02      & 0.02       \\
                                  & (0.24)     & (0.11)      & (0.08)     & (0.02)    & (0.05)     \\
\midrule
Mean                              & 3.23       & 1.26        & 0.82       & 0.13      & 0.29       \\
N                                 & 497        & 477         & 477        & 497       & 497        \\
\bottomrule
\multicolumn{6}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{}
\label{table:coefficients}
\end{center}
\end{table}
```



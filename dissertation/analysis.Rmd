---
title: "Tables for Teacher-like-me Paper"
date: "`r Sys.Date()`"
output:
  pdf_document:
    extra_dependencies: ["dcolumn", "booktabs", "caption", "float"]
    toc: yes
    toc_depth: 6
    keep_tex: yes
---

\captionsetup[table]{labelformat=empty}


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F, fig.retina = 4)
```

```{r message=FALSE, warning=FALSE}
# Libraries
pacman::p_load(haven, estimatr, extrafont, texreg, janitor, hrbrthemes, xtable, papeR, tidyverse, compareGroups, Hmisc, skimr)
```

\newpage

# Main Tables

```{r}
# Student Data
df_stu <- 
  read_dta(here::here("data", "stu_admin_all_latest.dta")) %>%
  left_join(read_dta(here::here("data/reservation_new.dta")), by = "stdid") %>% 
  mutate(
    reservation = dplyr::recode(reservation, "Non-reservation" = 0L, "Reservation" = 1L, .default = NA_integer_),
  )


df <- 
  read_dta(here::here("data", "all_appended.dta")) %>% 
  distinct(stdid, course_name, facid, .keep_all = T) %>% 
  left_join(
    df_stu %>% 
      select(stdid, classid, department_id, reservation, caste, ea_stud_group_criteria, grade),
    by = "stdid"
  ) %>%
  filter(ea_stud_group_criteria == 2, grade == 2) %>%
  left_join(read_dta(here::here("data/fac_covariates.dta")), by = "facid")


# fixing for course cleaning done by sk in sep 2021
df <-
  df %>% 
  left_join(
    read_dta(here::here("data/students_clean.dta")),
    by = c("department_id", "course_name")
  ) %>% 
  mutate(
    course_name = if_else(!is.na(course_clean_sk), course_clean_sk, course_name)
  ) %>%
  distinct(stdid, course_name, facid, .keep_all = T)


# grade data after veda's work
df_grades <-
  read_dta(here::here("data/30jan2022/df_gradefac.dta")) %>% 
  filter(facid != "") %>%
  left_join(df_stu %>% select(stdid, department_id, reservation, took_jee, b_i_jeemain_score, b_math_g1_score, b_physics_g1_score, e_math_g3_score, e_physics_g3_score, elite, b_ct_score, b_ql_score, b_rr_score, b_testtype), by = "stdid") %>%
  left_join(read_dta(here::here("data/controls.dta")), by = "stdid") %>%
  left_join(read_dta(here::here("data/fac_covariates.dta")), by = "facid") %>% 
  arrange(department_id, course_name, course_grade_clean) %>% 
  group_by(department_id, course_name) %>% 
  mutate(
    course_rank = (scale(course_grade_clean) %>% pnorm() * 100) %>% as.vector
  ) %>% 
  ungroup() %>%
  mutate(
    father_college = if_else(father_ed_ind > 3 & !is.na(father_ed_ind), 1L, 0L),
    father_college = if_else(is.na(father_ed_ind), NA_integer_, father_college),
    mother_college = if_else(mother_ed_ind > 3 & !is.na(mother_ed_ind), 1L, 0L),
    mother_college = if_else(is.na(mother_ed_ind), NA_integer_, mother_college),
    ses = ses %>% as.integer(),
  ) %>%
  relocate(department_id, course_name, stdid, course_rank) %>% 
  rename(reservation_stu = reservation, fac_teaching = fac_tpi_score7_z)

# df_grades %>% drop_na() %>% glimpse()
# df_grades %>% select(contains("college"))

rm(df)

df_mechanism <-
  df_grades %>%
  select(facid, reservation_fac, department_id, course_name, stdid, course_rank) %>% 
  left_join(
    read_dta(here::here("data/fac_covars1.dta")), 
    by = "facid"
  ) %>% 
  left_join(read_dta(here::here("data/fac_covars3.dta")), by = "facid") %>% 
  left_join(read_dta(here::here("data/fac_covars2.dta")), by = "facid") %>% 
  mutate_at(vars(starts_with("weekly")), ~ parse_number(.)) %>%
  mutate(
    total_time =
      pmap_dbl(
        select(., weekly_hours_teaching_related, weekly_hours_advising_students, weekly_hours_research, weekly_hours_part_time_job, weekly_hours_administrative),
        ~ sum(c(...), na.rm = TRUE)
      ),
    fac_prop_research = (weekly_hours_research * 10) / total_time
  )


# filtering to all faculty surveyed during the endline phase who were also mentioned by students
facdata_mentions <-
  read_dta(here::here("data/all_appended.dta")) %>%
  filter(tag > 1) %>%  # endline only
  left_join(df_stu %>% select(stdid, department_id), by = "stdid") %>%  # get dep_id
  select(facid, department_id) %>% 
  count(facid, department_id) %>% 
  arrange(facid, desc(n)) %>% 
  distinct(facid, .keep_all = T) %>% 
  select(-n) %>% 
  left_join(read_dta(here::here("data/endline_faculty_data_final.dta")), by = "facid")

fac_in_12colleges <- df_grades %>% distinct(facid) %>% drop_na(facid) %>% pull(facid)

efac_new_controls <-
  read_dta(here::here("data/efac_new_controls.dta")) %>% 
  transmute(
    facid, reservation_fac,
    govt_funding_yesno = if_else(govt_funding > 0, 1L, 0L),
    private_funding_yesno = if_else(private_funding > 0, 1L, 0L),
    admin_position_yesno = administrative_position,
    admin_weekly_hours = time_week_administrative,
    admin_weekly_hours_yesno = if_else(admin_weekly_hours > 0, 1L, 0L),
    funding_total,
    funding_yesno = if_else(funding_total > 0, 1L, 0L),
    attend_intl_conference = international_conference,
    conference_papers_yesno = if_else(publications_conference_papers > 0, 1L, 0L),
    conference_combined = if_else(attend_intl_conference == 1 | conference_papers_yesno == 1, 1L, 0L)
  )
```


```{r, eval="F"}
df_grades %>% 
  group_by(department_id, course_name, reservation_fac) %>% 
  summarise(
    course_rank = mean(course_rank, na.rm = T)
  ) %>% 
  ungroup() %>% 
  drop_na(reservation_fac, course_rank) %>% 
  pivot_wider(names_from = reservation_fac, values_from = course_rank) %>% 
  drop_na(`0`, `1`) %>% 
  mutate(`ATE` = `1` - `0`) %>% #summary()
  ggplot(aes(`ATE`)) +
  geom_histogram(alpha = 0.8) +
  geom_vline(xintercept = -0.2982, linetype = "dashed", color = "blue") +
  theme_minimal()
  
df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac, data = ., fixed_effects = ~ fe_var, se_type = "stata", clusters = facid) %>% 
  knitreg(include.ci = F)
```


```{r, eval=F}
# range of classrooms per course
df_grades %>% 
  distinct(department_id, course_name, facid) %>% 
  count(department_id, course_name) %>%
  arrange(-n) %>% 
  filter(n > 1) %>% 
  summary()

df_grades %>% distinct(department_id, course_name, facid)

df_grades %>% distinct(facid, reservation_fac) %>% count(reservation_fac)

facdata_mentions %>%
  distinct(facid, .keep_all = T) %>% 
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  drop_na(fac_reservation) %>%
  transmute(
    sw_f, fac_reservation, fac_yearsinhighed,
    rank = case_when(
      fac_assistant_professor == 1 ~ "Assistant Professor",
      fac_associate_professor == 1 ~ "Associate Professor",
      fac_professor == 1 ~ "Professor",
      TRUE ~ NA_character_
    )
  ) %>% 
  group_by(fac_reservation, rank) %>% 
  summarise(
    years = round(weighted.mean(fac_yearsinhighed, w = sw_f, na.rm = T), 2)
  ) %>% 
  drop_na(rank) %>% 
  pivot_wider(names_from = fac_reservation, values_from = years) %>% 
  rename(`Non-reservation` = `0`, Reservation = `1`, Rank = rank)
```

```{r, eval=F}
# balance checks for 63 departments
x <-
  read_dta(here::here("data", "all_appended.dta")) %>%
  distinct(stdid, course_name, facid, .keep_all = T) %>% 
  left_join(
    df_stu %>%
      select(stdid, department_id, reservation, grade) %>% 
      left_join(read_dta(here::here("data/controls.dta")), by = "stdid") %>% 
      mutate(
        father_college = if_else(father_ed_ind > 3 & !is.na(father_ed_ind), 1L, 0L),
        father_college = if_else(is.na(father_ed_ind), NA_integer_, father_college),
        mother_college = if_else(mother_ed_ind > 3 & !is.na(mother_ed_ind), 1L, 0L),
        mother_college = if_else(is.na(mother_ed_ind), NA_integer_, mother_college),
      ) %>%
      select(stdid, department_id, reservation, grade, reservation, female, age, father_college, mother_college),
    by = "stdid"
  ) %>%
  filter(grade == 2) %>% 
  anti_join(read_dta(here::here("data/37deps.dta")), by = "department_id") %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, reservation_fac), by = "facid") %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_"))


x %>%
  lm_robust(father_college ~ reservation_fac , data = ., fixed_effects = ~ fe_var, se_type = "stata", clusters = facid) %>%
  knitreg(include.ci = F, digits = 3, stars = c(0.01, 0.05, 0.1))
```




```{r, eval=F}
# new faculty balance table
efac_new_controls %>% 
  compareGroups(reservation_fac ~ govt_funding_yesno + private_funding_yesno + admin_position_yesno + admin_weekly_hours + admin_weekly_hours_yesno + funding_total + funding_yesno + attend_intl_conference + conference_papers_yesno + conference_combined, data = ., include.label = F) %>%
  createTable(show.all = F, show.n = T)
```


## Table 1: Faculty and Student Characteristics, Faculty Differences, and Balance Checks


```{r, eval = F}
df_grades %>% 
  distinct(stdid, .keep_all = T) %>%  # consider unique student/faculty observations
  select(b_ct_score, b_ql_score, b_rr_score) %>%
  mutate_all(~ scale(.) %>% as.vector) %>% 
  skim() %>% 
  as_tibble() %>% 
  mutate_if(is.numeric, ~ round(., 2))

df_grades %>%
  filter(!(is.na(b_ct_score) & is.na(b_ql_score))) %>%
  transmute(
    stdid, facid, reservation_fac,
    fe_var = str_c(department_id, course_name, sep = "_"),
    testtype = str_sub(b_testtype, 6, 10),
    b_ct_score = scale(b_ct_score) %>% as.vector,
    b_ql_score = scale(b_ql_score) %>% as.vector,
    b_rr_score = scale(b_rr_score) %>% as.vector,
  ) %>%
  pivot_longer(cols = contains("score"), values_drop_na = T, names_to = "exam", values_to = "b_hot_score") %>%
  mutate(exam = str_sub(exam, 3, 4) %>% str_to_upper()) %>%
  lm_robust(b_hot_score ~ reservation_fac + exam + testtype, data = ., fixed_effects = ~ fe_var, se_type = "stata", clusters = facid) %>%
  knitreg(include.ci = F, digits = 3, stars = c(0.01, 0.05, 0.1), include.rsquared = F, include.adjrs = F, include.rmse = F)
```



```{=latex}
\begin{table}[H]
  \centering
  \begin{tabular}{@{}lllllll@{}}
    \toprule
    \multicolumn{1}{c}{}  &  & \multicolumn{5}{c}{Panel A: Faculty}  \\ \cmidrule(l){3-7}
                                      &           &               &             &           &                             &             \\
    \textbf{Faculty characteristics}  & \textbf{} & \textbf{Mean} & \textbf{SD} & \textbf{} & \textbf{Res-NonRes faculty} & \textbf{SE} \\
                                      &           &               &             &           &                             &             \\
    Reservation status                &           & 0.39          & 0.49        &           & 1.000                       &             \\
    Assistant Professor               &           & 0.72          & 0.45        &           & 0.055                       & 0.061       \\
    Associate Professor               &           & 0.18          & 0.38        &           & 0.018                       & 0.043       \\
    Professor                         &           & 0.08          & 0.27        &           & -0.071                      & 0.043       \\
    Experience in years               &           & 9.96          & 6.51        &           & -1.391*                     & 0.793       \\
    Highest degree is Masters         &           & 0.51          & 0.50        &           & 0.147**                     & 0.074       \\
    Highest degree is PhD             &           & 0.32          & 0.47        &           & -0.133***                   & 0.041       \\
    Highest degree is PhD in progress &           & 0.15          & 0.36        &           & -0.023                      & 0.068       \\
    Degree college elite              &           & 0.32          & 0.47        &           & -0.109*                     & 0.063       \\
    Female                            &           & 0.33          & 0.47        &           & -0.008                      & 0.076       \\
                                      &           &               &             &           &                             &             \\ \cmidrule(l){3-7}
    &  & \multicolumn{5}{c}{Panel B: Students} \\ \cmidrule(l){3-7}
                                      &           &               &             &           &                             &             \\
    \textbf{Student characteristics}  & \textbf{} & \textbf{Mean} & \textbf{SD} & \textbf{} & \textbf{Res-NonRes faculty} & \textbf{SE} \\
                                      &           &               &             &           &                             &             \\
    Reservation status                &           & 0.54          & 0.50        &           & -0.008                      & 0.010       \\
    Female                            &           & 0.44          & 0.50        &           & -0.002                      & 0.007       \\
    Age                               &           & 17.72         & 0.80        &           & 0.001                       & 0.011       \\
    Father college                    &           & 0.50          & 0.50        &           & 0.005                       & 0.010       \\
    Mother college                    &           & 0.35          & 0.48        &           & 0.018**                     & 0.008       \\ \bottomrule
  \end{tabular}
\end{table}
```


\newpage

## Table 2: Regressions for Quality of Instruction by Reservation Faculty

Main:

```{r, results='asis', eval=F}
lm1.2a <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm1.2b <-
  df_grades %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm1.2c <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm1.2d <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

knitreg(list(lm1.2a, lm1.2b, lm1.2c, lm1.2d), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III", "IV"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```


```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} \\
\midrule
Reservation faculty               & 1.44^{**} & 1.52^{**} & 1.33^{**}  & 1.34^{**}  \\
                                  & (0.58)    & (0.59)    & (0.57)     & (0.56)     \\
Associate professor               &           & 0.57      & 1.25       & 1.27       \\
                                  &           & (0.75)    & (0.83)     & (0.82)     \\
Professor                         &           & 1.46      & 2.97^{**}  & 3.18^{**}  \\
                                  &           & (0.93)    & (1.35)     & (1.32)     \\
Experience in years               &           & -0.02     & -0.02      & -0.01      \\
                                  &           & (0.05)    & (0.05)     & (0.05)     \\
Highest degree is PhD             &           &           & -2.37^{**} & -2.55^{**} \\
                                  &           &           & (1.19)     & (1.17)     \\
Highest degree is PhD in progress &           &           & -0.75      & -0.94      \\
                                  &           &           & (0.80)     & (0.82)     \\
Degree college elite              &           &           & 0.37       & 0.31       \\
                                  &           &           & (0.59)     & (0.59)     \\
Female                            &           &           &            & 1.09^{*}   \\
                                  &           &           &            & (0.57)     \\
\midrule
Num. obs.                         & 37767     & 37716     & 37716      & 37716      \\
N Clusters                        & 498       & 496       & 496        & 496        \\
\bottomrule
\multicolumn{5}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{}
\label{table:coefficients}
\end{center}
\end{table}
```


Notes:

1. The dependent variable is the student course grade.
2. Grades are provided at the course level and not the faculty level.
3. Standard errors are clustered at faculty level.

\newpage

For appendix (try 1):

```{r, results='asis', eval=F}
lm1.2a <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ fe_var, se_type = "stata", clusters = facid)

lm1.2b <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
    miss_female = if_else(is.na(female), 1L, 0L),
    female = if_else(is.na(female), 0, female),
    miss_reservation_stu = if_else(is.na(reservation_stu), 1L, 0L),
    reservation_stu = if_else(is.na(reservation_stu), 0L, reservation_stu),
    miss_father_college = if_else(is.na(father_college), 1L, 0L),
    father_college = if_else(is.na(father_college), 0L, father_college),
    miss_mother_college = if_else(is.na(mother_college), 1L, 0L),
    mother_college = if_else(is.na(mother_college), 0L, mother_college),
  ) %>%
  lm_robust(course_rank ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female + reservation_stu + female + age + father_college + mother_college + miss_reservation_stu + miss_female + miss_age + miss_father_college + miss_mother_college, data = ., fixed_effects = ~ fe_var, se_type = "stata", clusters = facid)

lm1.2c <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm1.2a, lm1.2b, lm1.2c), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F)
```


\newpage

For appendix (try 2):

```{r, results='asis', eval=F}
lm1.2a <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  mutate(
    miss_reservation_stu = if_else(is.na(reservation_stu), 1L, 0L),
    reservation_stu = if_else(is.na(reservation_stu), 0L, reservation_stu),
  ) %>% 
  lm_robust(course_rank ~ reservation_fac * reservation_stu + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female + miss_reservation_stu, data = ., fixed_effects = ~ fe_var, se_type = "stata", clusters = facid)

lm1.2b <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
    miss_female = if_else(is.na(female), 1L, 0L),
    female = if_else(is.na(female), 0, female),
    miss_reservation_stu = if_else(is.na(reservation_stu), 1L, 0L),
    reservation_stu = if_else(is.na(reservation_stu), 0L, reservation_stu),
    miss_father_college = if_else(is.na(father_college), 1L, 0L),
    father_college = if_else(is.na(father_college), 0L, father_college),
    miss_mother_college = if_else(is.na(mother_college), 1L, 0L),
    mother_college = if_else(is.na(mother_college), 0L, mother_college),
  ) %>%
  lm_robust(course_rank ~ reservation_fac * reservation_stu + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female + female + age + father_college + mother_college + miss_reservation_stu + miss_female + miss_age + miss_father_college + miss_mother_college, data = ., fixed_effects = ~ fe_var, se_type = "stata", clusters = facid)

lm1.2c <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  mutate(
    miss_reservation_stu = if_else(is.na(reservation_stu), 1L, 0L), # not used because of stufix effects
    reservation_stu = if_else(is.na(reservation_stu), 0L, reservation_stu),
  ) %>% 
  lm_robust(course_rank ~ reservation_fac * reservation_stu + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm1.2a, lm1.2b, lm1.2c), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F)
```


## Table 3: Regressions for Quality of Instruction by Reservation Faculty with Reservation Students

```{r, results='asis', eval=F}
lm4.2a <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * reservation_stu, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm4.2b <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * reservation_stu + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm4.2c <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * reservation_stu + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite , data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm4.2d <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * reservation_stu + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)


texreg(list(lm4.2a, lm4.2b, lm4.2c, lm4.2d), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III", "IV"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, custom.coef.names = c("Reservation faculty", "res_stu", "Reservation faculty x Reservation student", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"), omit.coef = "res_stu")
```


```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} \\
\midrule
Reservation faculty                       & 1.59^{**} & 1.68^{**} & 1.48^{**}  & 1.49^{**}  \\
                                          & (0.65)    & (0.65)    & (0.65)     & (0.64)     \\
Reservation faculty x Reservation student & -0.29     & -0.29     & -0.27      & -0.29      \\
                                          & (0.66)    & (0.66)    & (0.66)     & (0.66)     \\
Associate professor                       &           & 0.56      & 1.24       & 1.26       \\
                                          &           & (0.75)    & (0.83)     & (0.82)     \\
Professor                                 &           & 1.47      & 2.96^{**}  & 3.17^{**}  \\
                                          &           & (0.93)    & (1.36)     & (1.32)     \\
Experience in years                       &           & -0.02     & -0.02      & -0.01      \\
                                          &           & (0.05)    & (0.05)     & (0.05)     \\
Highest degree is PhD                     &           &           & -2.36^{**} & -2.53^{**} \\
                                          &           &           & (1.19)     & (1.17)     \\
Highest degree is PhD in progress         &           &           & -0.75      & -0.95      \\
                                          &           &           & (0.80)     & (0.82)     \\
Degree college elite                      &           &           & 0.37       & 0.30       \\
                                          &           &           & (0.59)     & (0.59)     \\
Female                                    &           &           &            & 1.09^{*}   \\
                                          &           &           &            & (0.57)     \\
\midrule
Num. obs.                                 & 37718     & 37667     & 37667      & 37667      \\
N Clusters                                & 498       & 496       & 496        & 496        \\
\bottomrule
\multicolumn{5}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{}
\label{table:coefficients}
\end{center}
\end{table}
```

Notes:

1. The dependent variable is the student course grade.
2. Grades are provided at the course level and not the faculty level.
3. Standard errors are clustered at faculty level.

\newpage

## Table 4: Regressions for Quality of Instruction, Teacher-Like-Me Specifications

I: Course and student fixed effects

II: Course, student, and faculty fixed effects

III: Student and classroom fixed effects

```{r, results='asis', eval=FALSE}
lm1 <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * reservation_stu + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm2 <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * reservation_stu + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var + facid, se_type = "stata", clusters = facid)

lm3 <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, facid, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * reservation_stu + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm1, lm2, lm3), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2)
```


```{=latex}
\begin{table}[H]
  \begin{center}
    \begin{tabular}{l D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4}}
      \toprule
                                                & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} \\
      \midrule
      Reservation faculty                       & 1.49^{**}             &                        &                         \\
                                                & (0.64)                &                        &                         \\
      Reservation faculty x Reservation student & -0.29                 & -0.33                  & -0.32                   \\
                                                & (0.66)                & (0.68)                 & (0.69)                  \\
      Associate professor                       & 1.26                  &                        &                         \\
                                                & (0.82)                &                        &                         \\
      Professor                                 & 3.17^{**}             &                        &                         \\
                                                & (1.32)                &                        &                         \\
      Experience in years                       & -0.01                 &                        &                         \\
                                                & (0.05)                &                        &                         \\
      Highest degree is PhD                     & -2.53^{**}            &                        &                         \\
                                                & (1.17)                &                        &                         \\
      Highest degree is PhD in progress         & -0.95                 &                        &                         \\
                                                & (0.82)                &                        &                         \\
      Degree college elite                      & 0.30                  &                        &                         \\
                                                & (0.59)                &                        &                         \\
      Female                                    & 1.09^{*}              &                        &                         \\
                                                & (0.57)                &                        &                         \\
      \midrule
      Num. obs.                                 & 37667                 & 37667                  & 37667                   \\
      N Clusters                                & 496                   & 496                    & 496                     \\
      \bottomrule
      \multicolumn{4}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
    \end{tabular}
    \caption{}
    \label{table:coefficients}
  \end{center}
\end{table}
```

Notes:

1. The dependent variable is the student course grade.
2. Grades are provided at the course level and not the faculty level.
3. Standard errors are clustered at faculty level.

\newpage

## Table 5: Regressions for Quality of Instruction by Reservation Faculty for Detailed Student Categories

```{r, eval=F}
df_grades %>% 
  left_join(read_dta(here::here("data/reservation_new.dta")), by = "stdid") %>%
  mutate(
    OBC_other_stu = if_else(caste == 2 | caste == 5, 1L, 0L),
    SC_ST_stu = if_else(caste == 3 | caste == 4, 1L, 0L),
  ) %>% 
  distinct(stdid, .keep_all = T) %>%
  tabyl(caste, OBC_other_stu)
```

```{r, results='asis', eval=F}
lm4.2a <-
  df_grades %>% 
  left_join(read_dta(here::here("data/reservation_new.dta")), by = "stdid") %>%
  mutate(
    OBC_other_stu = if_else(caste == 2 | caste == 5, 1L, 0L),
    SC_ST_stu = if_else(caste == 3 | caste == 4, 1L, 0L),
  ) %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * SC_ST_stu + reservation_fac * OBC_other_stu, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm4.2b <-
  df_grades %>% 
  left_join(read_dta(here::here("data/reservation_new.dta")), by = "stdid") %>%
  mutate(
    OBC_other_stu = if_else(caste == 2 | caste == 5, 1L, 0L),
    SC_ST_stu = if_else(caste == 3 | caste == 4, 1L, 0L),
  ) %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * SC_ST_stu + reservation_fac * OBC_other_stu + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm4.2c <-
  df_grades %>% 
  left_join(read_dta(here::here("data/reservation_new.dta")), by = "stdid") %>%
  mutate(
    OBC_other_stu = if_else(caste == 2 | caste == 5, 1L, 0L),
    SC_ST_stu = if_else(caste == 3 | caste == 4, 1L, 0L),
  ) %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * SC_ST_stu + reservation_fac * OBC_other_stu + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite , data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm4.2d <-
  df_grades %>% 
  left_join(read_dta(here::here("data/reservation_new.dta")), by = "stdid") %>%
  mutate(
    OBC_other_stu = if_else(caste == 2 | caste == 5, 1L, 0L),
    SC_ST_stu = if_else(caste == 3 | caste == 4, 1L, 0L),
  ) %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * SC_ST_stu + reservation_fac * OBC_other_stu + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)


knitreg(list(lm4.2a, lm4.2b, lm4.2c, lm4.2d), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III", "IV"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, custom.coef.names = c("Reservation faculty", "SC_ST_stu", "OBC_other_stu", "Reservation faculty x SC/ST student", "Reservation faculty x OBC/Other student", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```

```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} \\
\midrule
Reservation faculty                     & 1.60^{**} & 1.68^{**} & 1.48^{**}  & 1.50^{**}  \\
                                        & (0.65)    & (0.66)    & (0.65)     & (0.64)     \\
Reservation faculty x SC/ST student     & -0.49     & -0.49     & -0.48      & -0.47      \\
                                        & (1.47)    & (1.47)    & (1.47)     & (1.47)     \\
Reservation faculty x OBC/Other student & -0.23     & -0.23     & -0.21      & -0.23      \\
                                        & (0.59)    & (0.59)    & (0.59)     & (0.59)     \\
Associate professor                     &           & 0.56      & 1.24       & 1.26       \\
                                        &           & (0.75)    & (0.83)     & (0.82)     \\
Professor                               &           & 1.47      & 2.97^{**}  & 3.17^{**}  \\
                                        &           & (0.93)    & (1.36)     & (1.32)     \\
Experience in years                     &           & -0.02     & -0.02      & -0.01      \\
                                        &           & (0.05)    & (0.05)     & (0.05)     \\
Highest degree is PhD                   &           &           & -2.36^{**} & -2.53^{**} \\
                                        &           &           & (1.19)     & (1.17)     \\
Highest degree is PhD in progress       &           &           & -0.75      & -0.94      \\
                                        &           &           & (0.80)     & (0.82)     \\
Degree college elite                    &           &           & 0.37       & 0.30       \\
                                        &           &           & (0.59)     & (0.59)     \\
Female                                  &           &           &            & 1.09^{*}   \\
                                        &           &           &            & (0.57)     \\
\midrule
Num. obs.                               & 37718     & 37667     & 37667      & 37667      \\
N Clusters                              & 498       & 496       & 496        & 496        \\
\bottomrule
\multicolumn{5}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{}
\label{table:coefficients}
\end{center}
\end{table}
```

Notes:

1. The dependent variable is the student course grade.
2. Grades are provided at the course level and not the faculty level.
3. Standard errors are clustered at faculty level.

\newpage

## Table 5.5: Regressions for Weekly Hours on Various Teaching-Related Activities


```{r, results='asis', eval=F}
lm_hours2 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(weekly_hours_advising_students ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_hours3 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(weekly_hours_course ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_hours6 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(weekly_hours_lessons_planning ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_hours9 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(weekly_hours_teaching_class ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_hours11 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(weekly_hours_tutoring ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)


knitreg(list(lm_hours2, lm_hours3, lm_hours6, lm_hours9, lm_hours11), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, custom.model.names = c("Advising students", "Course related work", "Lesson planning", "Teaching class", "Tutoring"), custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```



```{r, eval= F}
# finding means for table below
df_mechanism %>% glimpse()

df_mechanism %>% 
  distinct(facid, .keep_all = T) %>% 
  summarize_at(vars(contains("weekly_hours")), ~ round(mean(., na.rm = T), 2))
```


```{=latex}
\begin{table}[H]
\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{l D{.}{.}{5.3} D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.3} D{.}{.}{5.4}}
\toprule
 & \multicolumn{1}{c}{Advising students} & \multicolumn{1}{c}{Course related work} & \multicolumn{1}{c}{Lesson planning} & \multicolumn{1}{c}{Teaching class} & \multicolumn{1}{c}{Tutoring} \\
\midrule
Reservation faculty               & -0.40  & 0.00       & 0.09       & -0.24  & -0.10      \\
                                  & (0.30) & (0.48)     & (0.92)     & (1.25) & (0.30)     \\
Associate professor               & -0.09  & -2.74^{**} & 0.11       & -0.20  & 0.26       \\
                                  & (0.38) & (1.26)     & (1.08)     & (1.60) & (0.40)     \\
Professor                         & -0.60  & -0.57      & -2.28      & -1.46  & -0.20      \\
                                  & (0.59) & (1.39)     & (1.67)     & (1.57) & (0.51)     \\
Experience in years               & 0.01   & 0.02       & -0.16^{**} & 0.10   & 0.04^{*}   \\
                                  & (0.03) & (0.03)     & (0.08)     & (0.08) & (0.02)     \\
Highest degree is PhD             & 0.58   & 3.75^{**}  & -0.54      & 0.42   & 0.58       \\
                                  & (0.49) & (1.64)     & (1.39)     & (1.17) & (0.44)     \\
Highest degree is PhD in progress & 0.52   & -0.45      & -0.65      & 1.15   & 0.43       \\
                                  & (0.54) & (0.56)     & (0.97)     & (1.11) & (0.36)     \\
Degree college elite              & -0.23  & -1.81^{**} & 0.69       & -0.83  & -0.72^{**} \\
                                  & (0.44) & (0.88)     & (0.99)     & (1.04) & (0.33)     \\
Female                            & -0.10  & -0.97      & -0.75      & -0.33  & 0.20       \\
                                  & (0.22) & (0.68)     & (0.87)     & (1.01) & (0.26)     \\
\midrule
Num. obs.                         & 37687  & 37789      & 37789      & 37789  & 37789      \\
N Clusters                        & 493    & 494        & 494        & 494    & 494        \\
\midrule
Mean value                        & 3.33   & 2.98       & 7.35       & 11.02  & 2.82       \\
\bottomrule
\multicolumn{6}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}}
\caption{}
\label{table:coefficients}
\end{center}
\end{table}
```

Notes:

1. The model includes course and student fixed effects.
2. Standard errors are clustered at faculty level.

\newpage

## Table 5.6: Regressions for TPI Measures on Use of Teaching Practices


```{r, results='asis', eval=F}
lm_tpi3 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(tpi_score3 ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_tpi4 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(tpi_score4 ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_tpi5 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(tpi_score5 ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_tpi8 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(tpi_score8 ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm_tpi3, lm_tpi4, lm_tpi5, lm_tpi8), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, custom.model.names = c("In-class features and activities", "Assignments", "Feedback and testing", "Collaboration"), custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```


```{r, eval= F}
# finding means for table below
df_mechanism %>% glimpse()

df_mechanism %>% 
  distinct(facid, .keep_all = T) %>% 
  summarize_at(vars(starts_with("tpi")), ~ round(mean(., na.rm = T), 2))
```


```{=latex}
\begin{table}[H]
\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{l D{.}{.}{5.5} D{.}{.}{5.4} D{.}{.}{5.5} D{.}{.}{5.4}}
\toprule
 & \multicolumn{1}{c}{In-class features and activities} & \multicolumn{1}{c}{Assignments} & \multicolumn{1}{c}{Feedback and testing} & \multicolumn{1}{c}{Collaboration} \\
\midrule
Reservation faculty               & -0.23       & -0.20     & -0.13      & -0.21     \\
                                  & (0.35)      & (0.26)    & (0.38)     & (0.22)    \\
Associate professor               & 0.10        & 0.16      & 0.46       & -0.17     \\
                                  & (0.43)      & (0.30)    & (0.52)     & (0.26)    \\
Professor                         & 0.81        & 0.04      & 1.10       & -0.10     \\
                                  & (0.55)      & (0.45)    & (0.69)     & (0.31)    \\
Experience in years               & 0.02        & 0.04^{**} & 0.08^{**}  & 0.04^{**} \\
                                  & (0.02)      & (0.02)    & (0.03)     & (0.02)    \\
Highest degree is PhD             & -0.21       & -0.46     & -0.63      & -0.30     \\
                                  & (0.51)      & (0.32)    & (0.54)     & (0.32)    \\
Highest degree is PhD in progress & 1.16^{**}   & -0.04     & 1.30^{***} & 0.28      \\
                                  & (0.45)      & (0.30)    & (0.40)     & (0.23)    \\
Degree college elite              & -0.31       & 0.34      & -0.41      & -0.01     \\
                                  & (0.30)      & (0.27)    & (0.33)     & (0.21)    \\
Female                            & -1.11^{***} & 0.33      & -0.09      & 0.25      \\
                                  & (0.35)      & (0.24)    & (0.35)     & (0.19)    \\
\midrule
Num. obs.                         & 37970       & 37970     & 37970      & 37970     \\
N Clusters                        & 497         & 497       & 497        & 497       \\
\midrule
Mean value                        & 9.65       & 3.55     & 8.28      & 4.20     \\
\bottomrule
\multicolumn{5}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}}
\caption{}
\label{table:coefficients}
\end{center}
\end{table}
```


Notes:

1. The model includes course and student fixed effects.
2. Standard errors are clustered at faculty level.


\newpage

## New combo regressions, didnt work, revert to stucourse level regressions for appendix [6-6-2023]

```{r, results='asis'}
lm1 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>% 
  mutate(fac_publications = fac_publications/3,
         fac_publications = if_else(fac_publications > 10, 10, fac_publications)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(fac_publications ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm2 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(
    efac_pub_intl = replace_na(efac_pub_intl, 0L),
    efac_pub_intl = efac_pub_intl/3,
    efac_pub_intl = if_else(efac_pub_intl > 10, 10, efac_pub_intl)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(efac_pub_intl ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm3 <-
  df_mechanism %>%
  left_join(read_dta(here::here("data/efac_new_controls.dta")) %>% select(facid, efac_pub_intl, efac_pub_sci, efac_pub_ei, efac_pub_ssci), by = "facid") %>%
  mutate_at(vars(efac_pub_intl, efac_pub_sci, efac_pub_ei, efac_pub_ssci), ~ replace_na(., 0)) %>% 
  mutate(
    efac_pub_intl = efac_pub_intl/3,
    efac_pub_intl = if_else(efac_pub_intl > 10, 10, efac_pub_intl),
    efac_pub_sci_ei_ssci = (efac_pub_sci + efac_pub_ei + efac_pub_ssci)/3,
    efac_pub_sci_ei_ssci = if_else(efac_pub_sci_ei_ssci > efac_pub_intl, efac_pub_intl, efac_pub_sci_ei_ssci)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(efac_pub_sci_ei_ssci ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm4 <-
  df_mechanism %>%
  left_join(efac_new_controls %>% select(facid, funding_yesno), by = "facid") %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(funding_yesno ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm5 <-
  df_mechanism %>%
  left_join(efac_new_controls %>% select(facid, admin_position_yesno), by = "facid") %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(admin_position_yesno ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm1, lm2, lm3, lm4, lm5), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, custom.model.names = c("I", "II", "III", "IV", "V"))
```


```{r}
df_mechanism %>%
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>% 
  left_join(read_dta(here::here("data/efac_new_controls.dta")) %>% select(facid, efac_pub_intl, efac_pub_sci, efac_pub_ei, efac_pub_ssci), by = "facid") %>%
  left_join(efac_new_controls %>% select(facid, admin_position_yesno, funding_yesno), by = "facid") %>%
  mutate_at(vars(efac_pub_intl, efac_pub_sci, efac_pub_ei, efac_pub_ssci), ~ replace_na(., 0)) %>% 
  mutate(
    efac_pub_intl = efac_pub_intl/3,
    efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl),
    efac_pub_sci_ei_ssci = (efac_pub_sci + efac_pub_ei + efac_pub_ssci)/3,
    efac_pub_sci_ei_ssci = if_else(efac_pub_sci_ei_ssci > efac_pub_intl, efac_pub_intl, efac_pub_sci_ei_ssci)
  ) %>% 
  #distinct(facid, .keep_all = T) %>% 
  filter(is.na(admin_position_yesno)) %>% view()
  skim(facid, fac_publications, efac_pub_intl, efac_pub_sci_ei_ssci, funding_yesno, admin_position_yesno)
```



\newpage

## Table 6.1: Regressions for Total Number of Publications per Year


```{r, results='asis', eval=F}
# OLD (stu-course level for 12 college sample)

lm_pub1 <-
  df_mechanism %>%
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>% 
  mutate(fac_publications = fac_publications/3,
         fac_publications = if_else(fac_publications > 30, 30, fac_publications)) %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(fac_publications ~ reservation_fac, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub2 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>% 
  mutate(fac_publications = fac_publications/3,
         fac_publications = if_else(fac_publications > 30, 30, fac_publications)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(fac_publications ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub3 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>% 
  mutate(fac_publications = fac_publications/3,
         fac_publications = if_else(fac_publications > 30, 30, fac_publications)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(fac_publications ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub4 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>% 
  mutate(fac_publications = fac_publications/3,
         fac_publications = if_else(fac_publications > 30, 30, fac_publications)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(fac_publications ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, custom.model.names = c("I", "II", "III", "IV"), custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"), include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F)
```



```{r, results='asis', eval=F}
# RUN AT FACULTY LEVEL (NEW)

lm_pub1 <-
  facdata_mentions %>%
  filter(facid %in% fac_in_12colleges) %>% 
  mutate(
    fac_publications = fac_publications/3,
    fac_publications = if_else(fac_publications > 30, 30, fac_publications),
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(fac_publications ~ fac_reservation, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub2 <-
  facdata_mentions %>%
  #filter(facid %in% fac_in_12colleges) %>%
  mutate(
    fac_publications = fac_publications/3,
    fac_publications = if_else(fac_publications > 30, 30, fac_publications),
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(fac_publications ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub3 <-
  facdata_mentions %>%
  #filter(facid %in% fac_in_12colleges) %>%
  mutate(
    fac_publications = fac_publications/3,
    fac_publications = if_else(fac_publications > 30, 30, fac_publications),
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(fac_publications ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub4 <-
  facdata_mentions %>%
  #filter(facid %in% fac_in_12colleges) %>%
  mutate(
    fac_publications = fac_publications/3,
    fac_publications = if_else(fac_publications > 30, 30, fac_publications),
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(fac_publications ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)


texreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, custom.model.names = c("I", "II", "III", "IV"), custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```


```{r, eval=F}
df_mechanism %>% 
  distinct(facid, .keep_all = T) %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications, efac_pub_intl), by = "facid") %>% 
  transmute(
    fac_publications = fac_publications/3,
    efac_pub_intl = efac_pub_intl/3,
    fac_publications = if_else(fac_publications > 30, 30, fac_publications),
    efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)
  ) %>%
  summary()
```


```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{5.4} D{.}{.}{5.5} D{.}{.}{5.5} D{.}{.}{5.5}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} \\
\midrule
Reservation faculty               & -3.31^{**} & -2.38^{*}   & -1.71       & -1.72       \\
                                  & (1.46)     & (1.35)      & (1.28)      & (1.28)      \\
Associate professor               &            & 9.00^{***}  & 7.22^{***}  & 7.21^{***}  \\
                                  &            & (1.66)      & (1.75)      & (1.74)      \\
Professor                         &            & 19.37^{***} & 16.30^{***} & 16.10^{***} \\
                                  &            & (3.98)      & (4.27)      & (4.25)      \\
Experience in years               &            & -0.27^{*}   & -0.32^{**}  & -0.32^{**}  \\
                                  &            & (0.15)      & (0.14)      & (0.14)      \\
Highest degree is PhD             &            &             & 5.17^{*}    & 5.34^{*}    \\
                                  &            &             & (2.84)      & (2.85)      \\
Highest degree is PhD in progress &            &             & 2.80^{*}    & 2.98^{**}   \\
                                  &            &             & (1.43)      & (1.44)      \\
Degree college elite              &            &             & 1.38        & 1.43        \\
                                  &            &             & (1.49)      & (1.50)      \\
Female                            &            &             &             & -1.02       \\
                                  &            &             &             & (1.08)      \\
\midrule
Num. obs.                         & 38021      & 37970       & 37970       & 37970       \\
N Clusters                        & 499        & 497         & 497         & 497         \\
\midrule
Mean value                         & 10.34      & 10.34       & 10.34       & 10.34       \\
\bottomrule
\multicolumn{5}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{Regressions for Total Number of Publications per Year}
\label{table:coefficients}
\end{center}
\end{table}
```

Notes:

1. The dependent variable is the total number of peer-reviewed publications for faculty.
2. The model includes course and student fixed effects.
3. Standard errors are clustered at faculty level.

\newpage

## Table 6.2: Regressions for Number of International Publications per Year

All International:

```{r, results='asis', eval=F}
# RUN AT FACULTY LEVEL (NEW)

lm_pub1 <-
  facdata_mentions %>%
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(
    efac_pub_intl = replace_na(efac_pub_intl, 0L),
    efac_pub_intl = efac_pub_intl/3,
    efac_pub_intl = if_else(efac_pub_intl > 10, 10, efac_pub_intl)
  ) %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(efac_pub_intl ~ fac_reservation, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub2 <-
  facdata_mentions %>%
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(
    efac_pub_intl = replace_na(efac_pub_intl, 0L),
    efac_pub_intl = efac_pub_intl/3,
    efac_pub_intl = if_else(efac_pub_intl > 10, 10, efac_pub_intl)
  ) %>%
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(efac_pub_intl ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub3 <-
  facdata_mentions %>%
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(
    efac_pub_intl = replace_na(efac_pub_intl, 0L),
    efac_pub_intl = efac_pub_intl/3,
    efac_pub_intl = if_else(efac_pub_intl > 10, 10, efac_pub_intl)
  ) %>%
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(efac_pub_intl ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub4 <-
  facdata_mentions %>%
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(
    efac_pub_intl = replace_na(efac_pub_intl, 0L),
    efac_pub_intl = efac_pub_intl/3,
    efac_pub_intl = if_else(efac_pub_intl > 10, 10, efac_pub_intl)
  ) %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(efac_pub_intl ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)


texreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, custom.model.names = c("I", "II", "III", "IV"), custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```


SCI + EI + SSCI International:

```{r, results='asis', eval=F}
# RUN AT FACULTY LEVEL (NEW)

lm_pub1 <-
  facdata_mentions %>%
  left_join(read_dta(here::here("data/efac_new_controls.dta")) %>% select(facid, efac_pub_intl, efac_pub_sci, efac_pub_ei, efac_pub_ssci), by = "facid") %>%
  mutate_at(vars(efac_pub_intl, efac_pub_sci, efac_pub_ei, efac_pub_ssci), ~ replace_na(., 0)) %>% 
  mutate(
    efac_pub_intl = efac_pub_intl/3,
    efac_pub_intl = if_else(efac_pub_intl > 10, 10, efac_pub_intl),
    efac_pub_sci_ei_ssci = (efac_pub_sci + efac_pub_ei + efac_pub_ssci)/3,
    efac_pub_sci_ei_ssci = if_else(efac_pub_sci_ei_ssci > efac_pub_intl, efac_pub_intl, efac_pub_sci_ei_ssci),
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(efac_pub_sci_ei_ssci ~ fac_reservation, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub2 <-
  facdata_mentions %>%
  left_join(read_dta(here::here("data/efac_new_controls.dta")) %>% select(facid, efac_pub_intl, efac_pub_sci, efac_pub_ei, efac_pub_ssci), by = "facid") %>%
  mutate_at(vars(efac_pub_intl, efac_pub_sci, efac_pub_ei, efac_pub_ssci), ~ replace_na(., 0)) %>% 
  mutate(
    efac_pub_intl = efac_pub_intl/3,
    efac_pub_intl = if_else(efac_pub_intl > 10, 10, efac_pub_intl),
    efac_pub_sci_ei_ssci = (efac_pub_sci + efac_pub_ei + efac_pub_ssci)/3,
    efac_pub_sci_ei_ssci = if_else(efac_pub_sci_ei_ssci > efac_pub_intl, efac_pub_intl, efac_pub_sci_ei_ssci),
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(efac_pub_sci_ei_ssci ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub3 <-
  facdata_mentions %>%
  left_join(read_dta(here::here("data/efac_new_controls.dta")) %>% select(facid, efac_pub_intl, efac_pub_sci, efac_pub_ei, efac_pub_ssci), by = "facid") %>%
  mutate_at(vars(efac_pub_intl, efac_pub_sci, efac_pub_ei, efac_pub_ssci), ~ replace_na(., 0)) %>% 
  mutate(
    efac_pub_intl = efac_pub_intl/3,
    efac_pub_intl = if_else(efac_pub_intl > 10, 10, efac_pub_intl),
    efac_pub_sci_ei_ssci = (efac_pub_sci + efac_pub_ei + efac_pub_ssci)/3,
    efac_pub_sci_ei_ssci = if_else(efac_pub_sci_ei_ssci > efac_pub_intl, efac_pub_intl, efac_pub_sci_ei_ssci),
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(efac_pub_sci_ei_ssci ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub4 <-
  facdata_mentions %>%
  left_join(read_dta(here::here("data/efac_new_controls.dta")) %>% select(facid, efac_pub_intl, efac_pub_sci, efac_pub_ei, efac_pub_ssci), by = "facid") %>%
  mutate_at(vars(efac_pub_intl, efac_pub_sci, efac_pub_ei, efac_pub_ssci), ~ replace_na(., 0)) %>% 
  mutate(
    efac_pub_intl = efac_pub_intl/3,
    efac_pub_intl = if_else(efac_pub_intl > 10, 10, efac_pub_intl),
    efac_pub_sci_ei_ssci = (efac_pub_sci + efac_pub_ei + efac_pub_ssci)/3,
    efac_pub_sci_ei_ssci = if_else(efac_pub_sci_ei_ssci > efac_pub_intl, efac_pub_intl, efac_pub_sci_ei_ssci),
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(efac_pub_sci_ei_ssci ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

texreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 4, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, custom.model.names = c("I", "II", "III", "IV"), custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```



```{r, results='asis', eval=F}
# OLD (Stu-course level for 12 colleges)

lm_pub1 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(efac_pub_intl = efac_pub_intl/3,
         efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(efac_pub_intl ~ reservation_fac, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub2 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(efac_pub_intl = efac_pub_intl/3,
         efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(efac_pub_intl ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub3 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(efac_pub_intl = efac_pub_intl/3,
         efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(efac_pub_intl ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub4 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(efac_pub_intl = efac_pub_intl/3,
         efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(efac_pub_intl ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for Number of International Publications per Year", digits = 2, custom.model.names = c("I", "II", "III", "IV"), custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```

```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{5.5} D{.}{.}{5.5} D{.}{.}{5.5} D{.}{.}{5.5}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} \\
\midrule
Reservation faculty               & -1.51^{***} & -1.34^{***} & -1.04^{**} & -1.04^{**} \\
                                  & (0.53)      & (0.50)      & (0.49)     & (0.50)     \\
Associate professor               &             & 3.98^{***}  & 3.35^{***} & 3.38^{***} \\
                                  &             & (0.79)      & (0.80)     & (0.80)     \\
Professor                         &             & 6.39^{***}  & 5.37^{***} & 5.28^{***} \\
                                  &             & (1.70)      & (2.00)     & (1.99)     \\
Experience in years               &             & -0.07       & -0.09^{*}  & -0.09^{*}  \\
                                  &             & (0.05)      & (0.05)     & (0.05)     \\
Highest degree is PhD             &             &             & 1.93^{*}   & 1.98^{*}   \\
                                  &             &             & (1.17)     & (1.17)     \\
Highest degree is PhD in progress &             &             & 1.49^{**}  & 1.56^{**}  \\
                                  &             &             & (0.66)     & (0.65)     \\
Degree college elite              &             &             & 0.14       & 0.19       \\
                                  &             &             & (0.68)     & (0.68)     \\
Female                            &             &             &            & -0.54      \\
                                  &             &             &            & (0.45)     \\
\midrule
Num. obs.                         & 36093       & 36093      & 36093      & 36093      \\
N Clusters                        & 477         & 477        & 477        & 477        \\
\midrule
Mean value                        & 3.81        & 3.81       & 3.81       & 3.81       \\
\bottomrule
\multicolumn{5}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{Regressions for Number of Publications in International Journals per Year}
\label{tab:tab29}
\end{center}
\end{table}
```


Notes:

1. The dependent variable is the total number of international journal publications for faculty.
2. The model includes course and student fixed effects.
3. Standard errors are clustered at faculty level.


## Table 6.21: Funding yes/no

All funding:

```{r, results='asis', eval=F}
# RUN AT FACULTY LEVEL (NEW)

lm_pub1 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, funding_yesno), by = "facid") %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(funding_yesno ~ fac_reservation, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub2 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, funding_yesno), by = "facid") %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(funding_yesno ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub3 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, funding_yesno), by = "facid") %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(funding_yesno ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub4 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, funding_yesno), by = "facid") %>%
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(funding_yesno ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)


knitreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, custom.model.names = c("I", "II", "III", "IV"), custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```

Govt funding:

```{r, results='asis', eval=F}
# RUN AT FACULTY LEVEL (NEW)

lm_pub1 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, govt_funding_yesno), by = "facid") %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(govt_funding_yesno ~ fac_reservation, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub2 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, govt_funding_yesno), by = "facid") %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(govt_funding_yesno ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub3 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, govt_funding_yesno), by = "facid") %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(govt_funding_yesno ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub4 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, govt_funding_yesno), by = "facid") %>%
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(govt_funding_yesno ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)


texreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 4, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, custom.model.names = c("I", "II", "III", "IV"), custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```


Private funding:

```{r, results='asis', eval=F}
# RUN AT FACULTY LEVEL (NEW)

lm_pub1 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, private_funding_yesno), by = "facid") %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(private_funding_yesno ~ fac_reservation, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub2 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, private_funding_yesno), by = "facid") %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(private_funding_yesno ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub3 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, private_funding_yesno), by = "facid") %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(private_funding_yesno ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub4 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, private_funding_yesno), by = "facid") %>%
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(private_funding_yesno ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)


texreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 4, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, custom.model.names = c("I", "II", "III", "IV"), custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```




## Table 6.22: Admin yes/no

```{r, results='asis', eval=F}
# RUN AT FACULTY LEVEL (NEW)

lm_pub1 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, admin_position_yesno), by = "facid") %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(admin_position_yesno ~ fac_reservation, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub2 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, admin_position_yesno), by = "facid") %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(admin_position_yesno ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub3 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, admin_position_yesno), by = "facid") %>% 
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(admin_position_yesno ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)

lm_pub4 <-
  facdata_mentions %>%
  left_join(efac_new_controls %>% select(facid, admin_position_yesno), by = "facid") %>%
  mutate(
    univcode = str_sub(department_id, 1, 5),
    majtype = str_sub(department_id, 6, 7),
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  lm_robust(admin_position_yesno ~ fac_reservation + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", weights = sw_f, fixed_effects = ~ univcode + majtype)


knitreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, include.nclust = F, include.rsquared = F, include.adjrs = F, include.rmse = F, custom.model.names = c("I", "II", "III", "IV"), custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```


\newpage

## Table 6.3: Regressions for Proportion of Time Spent on Research [Now collaboration read!!]


```{r, results='asis', eval=F}
lm_pub1 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/x.dta")), by = "facid") %>%
  mutate(
    collaboration_read = case_when(
      collaboration_read == "a" ~ 1,
      collaboration_read == "b" ~ 0,
      collaboration_read == "c" ~ 0,
      collaboration_read == "d" ~ 0,
      TRUE ~ NA_real_
    )
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(collaboration_read ~ reservation_fac, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub2 <-
  df_mechanism %>% 
  left_join(haven::read_dta(here::here("data/x.dta")), by = "facid") %>%
  mutate(
    collaboration_read = case_when(
      collaboration_read == "a" ~ 1,
      collaboration_read == "b" ~ 0,
      collaboration_read == "c" ~ 0,
      collaboration_read == "d" ~ 0,
      TRUE ~ NA_real_
    )
  ) %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(collaboration_read ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub3 <-
  df_mechanism %>% 
  left_join(haven::read_dta(here::here("data/x.dta")), by = "facid") %>%
  mutate(
    collaboration_read = case_when(
      collaboration_read == "a" ~ 1,
      collaboration_read == "b" ~ 0,
      collaboration_read == "c" ~ 0,
      collaboration_read == "d" ~ 0,
      TRUE ~ NA_real_
    )
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(collaboration_read ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub4 <-
  df_mechanism %>% 
  left_join(haven::read_dta(here::here("data/x.dta")), by = "facid") %>% glimpse()
  mutate(
    collaboration_read = case_when(
      collaboration_read == "a" ~ 1,
      collaboration_read == "b" ~ 0,
      collaboration_read == "c" ~ 0,
      collaboration_read == "d" ~ 0,
      TRUE ~ NA_real_
    )
  ) %>% #distinct(facid, .keep_all = T) %>% skimr::skim(collaboration_read)
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(collaboration_read ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

knitreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, custom.model.names = c("I", "II", "III", "IV"), include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F, custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```

```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{5.3} D{.}{.}{5.4} D{.}{.}{5.5} D{.}{.}{5.5}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} \\
\midrule
Reservation faculty               & -0.13  & -0.16     & -0.07      & -0.07      \\
                                  & (0.22) & (0.22)    & (0.19)     & (0.19)     \\
Associate professor               &        & 0.55^{**} & 0.52^{**}  & 0.52^{**}  \\
                                  &        & (0.23)    & (0.25)     & (0.25)     \\
Professor                         &        & -0.37     & -0.34      & -0.31      \\
                                  &        & (0.34)    & (0.37)     & (0.37)     \\
Experience in years               &        & 0.00      & -0.02      & -0.02      \\
                                  &        & (0.02)    & (0.02)     & (0.02)     \\
Highest degree is PhD             &        &           & 0.37       & 0.34       \\
                                  &        &           & (0.35)     & (0.35)     \\
Highest degree is PhD in progress &        &           & 0.95^{***} & 0.93^{***} \\
                                  &        &           & (0.27)     & (0.28)     \\
Degree college elite              &        &           & 0.28       & 0.27       \\
                                  &        &           & (0.24)     & (0.24)     \\
Female                            &        &           &            & 0.16       \\
                                  &        &           &            & (0.20)     \\
\midrule
Num. obs.                         & 37632  & 37624     & 37624      & 37624      \\
N Clusters                        & 493    & 492       & 492        & 492        \\
\midrule
Mean value                        & 2.12   & 2.12       & 2.12       & 2.12       \\
\bottomrule
\multicolumn{5}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{Regressions for Proportion of Time Spent on Research}
\label{tab:tab210}
\end{center}
\end{table}
```


Notes:

1. The dependent variable is the proportion of weekly research time (units of 10% of working time per week) for faculty. We construct a measure of faculty's time spent on research by dividing their reported research hours on the sum of hours from all the categories of work.
2. The model includes course and student fixed effects.
3. Standard errors are clustered at faculty level.


\newpage

# Appendix Tables

## Table B1: Comparing Analysis Sample with the Representative National Sample for India


```{r, eval=F}
# faculty
facdata_mentions %>% 
  select(department_id, fac_reservation, fac_assistant_professor, fac_associate_professor, fac_professor, fac_yearsinhighed, fac_highest_degree_masters, fac_highest_degree_phd_in_prog, fac_highest_degree_phd, fac_degree_college_elite, fac_female) %>% 
  bind_rows(
    df_grades %>% distinct(facid, .keep_all = T) %>% select(department_id, fac_reservation, fac_assistant_professor, fac_associate_professor, fac_professor, fac_yearsinhighed, fac_highest_degree_masters, fac_highest_degree_phd_in_prog, fac_highest_degree_phd, fac_degree_college_elite, fac_female), .id = "analysis_sample"
  ) %>% 
  mutate(
    analysis_sample = as.integer(analysis_sample) - 1L,
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  # mutate(sw_f = if_else(analysis_sample == 1L, 1, sw_f)) %>% 
  # mutate(sw_f = 1) %>% 
  group_by(analysis_sample) %>%
  summarize_at(vars(starts_with("fac_")), ~ round(weighted.mean(., w = sw_f, na.rm = T), 2)) %>%
  # summarize_at(vars(starts_with("fac_")), ~ round(sqrt(wtd.var(., sw_f)), 2)) %>%
  pivot_longer(cols = -analysis_sample) %>%
  pivot_wider(names_from = analysis_sample, values_from = value) %>% 
  select(variable = name, non_res = `0`, res = `1`)

df_grades %>% distinct(facid, .keep_all = T) %>% tabyl(reservation_fac)
```



```{r, eval=F}
# students
df_stu %>% 
  select(stdid, department_id, reservation) %>% 
  left_join(read_dta(here::here("data/controls.dta")), by = "stdid") %>% 
  mutate(
    father_college = if_else(father_ed_ind > 3 & !is.na(father_ed_ind), 1L, 0L),
    father_college = if_else(is.na(father_ed_ind), NA_integer_, father_college),
    mother_college = if_else(mother_ed_ind > 3 & !is.na(mother_ed_ind), 1L, 0L),
    mother_college = if_else(is.na(mother_ed_ind), NA_integer_, mother_college),
  ) %>%
  select(reservation, female, age, father_college, mother_college, department_id) %>% 
  bind_rows(
    df_grades %>% distinct(stdid, .keep_all = T) %>% select(reservation = reservation_stu, female, age, father_college, mother_college, department_id), .id = "analysis_sample"
  ) %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  mutate(
    analysis_sample = as.integer(analysis_sample) - 1L,
    female = female %>% as.integer()
  ) %>%
  mutate(sw_f = if_else(analysis_sample == 1L, 1, sw_f)) %>% 
  group_by(analysis_sample) %>%
  summarize_at(vars(reservation, female, age, father_college, mother_college), ~ round(weighted.mean(., w = sw_f, na.rm = T), 2)) %>%
  # summarize_at(vars(reservation, female, age, father_college, mother_college), ~ round(sqrt(wtd.var(., sw_f)), 2)) %>%
  pivot_longer(cols = -analysis_sample) %>%
  pivot_wider(names_from = analysis_sample, values_from = value) %>%
  select(name, `0`, `1`)
```


```{=latex}
\begin{table}[H]
\centering
\begin{scriptsize}
\caption{Comparing Analysis Sample with the Representative National Sample for India}
\label{tab:sample-stats}
\begin{threeparttable}
\begin{tabular}{@{}lll@{}}
\toprule
Attribute                         & Analysis Sample & Full Sample  \\ \midrule
                                  & \multicolumn{2}{c}{Faculty}    \\ \cmidrule(l){2-3} 
Reservation status                & 0.41 (0.49)     & 0.50 (0.50)  \\
Assistant professor               & 0.72 (0.45)     & 0.77 (0.42)  \\
Associate professor               & 0.17 (0.38)     & 0.13 (0.34)  \\
Professor                         & 0.07 (0.26)     & 0.06 (0.23)  \\
Experience in years               & 9.61 (6.23)     & 9.49 (6.86)  \\
Highest degree is Masters         & 0.59 (0.49)     & 0.61 (0.49)  \\
Highest degree is PhD in progress & 0.15 (0.35)     & 0.19 (0.39)  \\
Highest degree is PhD             & 0.24 (0.43)     & 0.17 (0.38)  \\
Degree from elite college         & 0.27 (0.44)     & 0.25 (0.43)  \\
Female                            & 0.35 (0.48)     & 0.42 (0.49)  \\
                                  &                 &              \\ \cmidrule(l){2-3}
                                  & \multicolumn{2}{c}{Students}   \\ \cmidrule(l){2-3} 
Reservation status                & 0.54 (0.50)     & 0.56 (0.50)  \\
Female                            & 0.39 (0.49)     & 0.41 (0.49)  \\
Age                               & 17.78 (0.84)    & 18.95 (1.49) \\
Father attended college           & 0.49 (0.50)     & 0.48 (0.50)  \\ \midrule
Number of students                & 2268            & 20239        \\
Number of faculty                 & 501             & 2710         \\
Number of colleges                & 12              & 50           \\
Number of departments             & 20              & 100          \\ \bottomrule
\end{tabular}
\begin{tablenotes}
        \item 1. Means reported with standard deviations in parentheses.
        \item 2. All statistics calculated using department-level sampling weights defined across the full national sample of surveyed colleges.
\end{tablenotes}
\end{threeparttable}
\end{scriptsize}
\end{table}
```


Notes:

1. Means reported with standard deviations in parentheses.
2. All statistics calculated using department-level sampling weights defined across the full national sample of surveyed colleges.



## Table C1: Regressions for Quality of Instruction by Reservation Faculty (weighing each classroom the same)


```{r, results='asis', eval=F}
lm1.2a <-
  df_grades %>% 
  inner_join(df_grades %>% count(department_id, course_name, facid, name = "classroom_size")) %>% 
  mutate(class_wt = 1/classroom_size) %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid, weights = class_wt)

lm1.2b <-
  df_grades %>% 
  inner_join(df_grades %>% count(department_id, course_name, facid, name = "classroom_size")) %>% 
  mutate(class_wt = 1/classroom_size) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid, weights = class_wt)

lm1.2c <-
  df_grades %>% 
  inner_join(df_grades %>% count(department_id, course_name, facid, name = "classroom_size")) %>% 
  mutate(class_wt = 1/classroom_size) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid, weights = class_wt)

lm1.2d <-
  df_grades %>% 
  inner_join(df_grades %>% count(department_id, course_name, facid, name = "classroom_size")) %>% 
  mutate(class_wt = 1/classroom_size) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid, weights = class_wt)


texreg(list(lm1.2a, lm1.2b, lm1.2c, lm1.2d), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III", "IV"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"), include.rsquared = F, include.adjrs = F, include.rmse = F)
```


Notes:

1. The dependent variable is the student course grade.
2. Reciprocal of classroom size used as regression weights.
3. Grades are provided at the course level and not the faculty level.
4. Standard errors are clustered at faculty level.


```{r, eval=F}
df_grades %>% count(department_id, course_name, facid) %>%
  ggplot(aes(n)) +
  geom_histogram() +
  theme_bw() +
  labs(x = "Class size", y = "Number of classroms")
```



## Table C2: Regressions for Quality of Instruction by Same Faculty-Student Status

For instance, for an SC student, the same Faculty-Student Status is 1 with SC faculty, and 0 with non-SC faculty.

```{r, results='asis'}
lm4.2a <-
  df_grades %>%
  drop_na(caste, fac_caste) %>% 
  mutate(
    fe_var = str_c(department_id, course_name, sep = "_"),
    same_stufac = if_else(caste == fac_caste & caste %in% c(2, 3, 4, 5), 1L, 0L)
  ) %>%
  lm_robust(course_rank ~ same_stufac + reservation_fac, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm4.2b <-
  df_grades %>%
  drop_na(caste, fac_caste) %>% 
  mutate(
    fe_var = str_c(department_id, course_name, sep = "_"),
    same_stufac = if_else(caste == fac_caste & caste %in% c(2, 3, 4, 5), 1L, 0L)
  ) %>%
  lm_robust(course_rank ~ same_stufac + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm4.2c <-
  df_grades %>%
  drop_na(caste, fac_caste) %>% 
  mutate(
    fe_var = str_c(department_id, course_name, sep = "_"),
    same_stufac = if_else(caste == fac_caste & caste %in% c(2, 3, 4, 5), 1L, 0L)
  ) %>%
  lm_robust(course_rank ~ same_stufac + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm4.2d <-
  df_grades %>%
  drop_na(caste, fac_caste) %>% 
  mutate(
    fe_var = str_c(department_id, course_name, sep = "_"),
    same_stufac = if_else(caste == fac_caste & caste %in% c(2, 3, 4, 5), 1L, 0L)
  ) %>%
  lm_robust(course_rank ~ same_stufac + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)


texreg(list(lm4.2a, lm4.2b, lm4.2c, lm4.2d), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III", "IV"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F, custom.coef.names = c("Student-faculty same category", "Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```


\newpage


## Table D1: Regressions for Student Course Performance by Reservation Student

```{r, results='asis'}
lm1 <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_stu, data = ., se_type = "stata", fixed_effects = ~ fe_var)

lm2 <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  lm_robust(course_rank ~ reservation_stu + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ fe_var)

lm3 <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  lm_robust(course_rank ~ reservation_stu + female + age + miss_age + father_college + mother_college + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ fe_var)

lm4 <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  lm_robust(course_rank ~ reservation_stu + female + age + miss_age + father_college + mother_college, fixed_effects = ~ fe_var + facid, data = ., se_type = "stata")


texreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III", "IV"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(fac_*)|(miss_age)", custom.coef.names = c("Reservation student", "Female student", "Student age", "Father attended college", "Mother attended college"))
```


\newpage


## Table D1.5: JEE Score/taking as control

```{r, results='asis'}
lm1 <-
  df_grades %>% 
  drop_na(b_i_jeemain_score) %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  lm_robust(course_rank ~ reservation_stu + female + age + miss_age + father_college + mother_college + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ fe_var)

lm2 <-
  df_grades %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  lm_robust(course_rank ~ reservation_stu + b_i_jeemain_score + female + age + miss_age + father_college + mother_college + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ fe_var)


lm3 <-
  df_grades %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age),
    took_jee = if_else(is.na(b_i_jeemain_score), 0L, 1L),
    # b_i_jeemain_score = if_else(is.na(b_i_jeemain_score), 0, b_i_jeemain_score),
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  lm_robust(course_rank ~ reservation_stu + took_jee + female + age + miss_age + father_college + mother_college + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ fe_var)


texreg(list(lm1, lm2, lm3), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for Student Course Performance by Student Reservation Status with JEE Main Controls", label = "table:reservationstudent2.5", digits = 2, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(fac_*)|(miss_age)", custom.coef.names = c("Reservation student", "Female student", "Student age", "Father attended college", "Mother attended college", "JEE Main score", "Took JEE Main"))
```


\newpage

## Table D2: Regressions for Student Course Performance by Student Reservation Status with Baseline Test Score Controls 


```{r}
b_math_mean <- -0.352288
b_math_sd <- 0.6328743

b_physics_mean <- -0.3577704
b_physics_sd <- 0.6084856

df_mp_zscores <-
  read_dta("/Users/saurabh/Everything/Supertest/Data/All/16. latest data for prashant (includng cr-flex scores)/1. student_baseline_endline_merged_data_11.7.2019.dta") %>% 
  filter(univtype == 1, country == "India") %>%  
  select(stdid, contains("irt_ability")) %>% 
  #inner_join(df_grades, ., by = "stdid") %>% 
  distinct(stdid, .keep_all = T) %>% 
  transmute(
    stdid,
    b_math_z = (scaled_math_irt_ability_g1 - b_math_mean)/b_math_sd,
    e_math_z = (scaled_math_irt_ability_g3 - b_math_mean)/b_math_sd,
    b_physics_z = (scaled_physics_irt_ability_g1 - b_physics_mean)/b_physics_sd,
    e_physics_z = (scaled_physics_irt_ability_g3 - b_physics_mean)/b_physics_sd,
  )
```


```{r, results='asis'}
lm1 <-
  df_grades %>%
  left_join(df_mp_zscores, by = "stdid") %>%
  drop_na(b_math_z, b_physics_z) %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  lm_robust(course_rank ~ reservation_stu + female + age + miss_age + father_college + mother_college + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ fe_var)

lm2 <-
  df_grades %>%
  left_join(df_mp_zscores, by = "stdid") %>% 
  drop_na(b_math_z, b_physics_z) %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%  
  lm_robust(course_rank ~ reservation_stu + b_math_z + female + age + miss_age + father_college + mother_college + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ fe_var)

lm3 <-
  df_grades %>%
  left_join(df_mp_zscores, by = "stdid") %>% 
  drop_na(b_math_z, b_physics_z) %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  lm_robust(course_rank ~ reservation_stu + b_physics_z + female + age + miss_age+  father_college + mother_college + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ fe_var)

lm4 <-
  df_grades %>%
  left_join(df_mp_zscores, by = "stdid") %>%
  drop_na(b_math_z, b_physics_z) %>% 
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  lm_robust(course_rank ~ reservation_stu + b_math_z + b_physics_z + female + age + miss_age + father_college + mother_college + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ fe_var)


texreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III", "IV"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for Student Course Performance by Student Reservation Status with Baseline Test Score Controls", label = "table:reservationstudent2", digits = 2, include.rsquared = F, include.adjrs = F, include.rmse = F, omit.coef = "(fac_*)|(miss_age)", custom.coef.names = c("Reservation student", "Female student", "Student age", "Father attended college", "Mother attended college", "Baseline math z-score", "Baseline physics z-score"))
```



\newpage

## Table D3: Regressions for Student Endline Math Test Scores by Student Reservation Status


```{r, results='asis'}
lm1 <-
  df_grades %>%
  left_join(df_mp_zscores, by = "stdid") %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  drop_na(b_math_z) %>% 
  lm_robust(e_math_z ~ reservation_stu, data = ., se_type = "stata", fixed_effects = ~ fe_var)

lm2 <-
  df_grades %>%
  left_join(df_mp_zscores, by = "stdid") %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  lm_robust(e_math_z ~ reservation_stu + b_math_z, data = ., se_type = "stata", fixed_effects = ~ fe_var)

lm3 <-
  df_grades %>%
  left_join(df_mp_zscores, by = "stdid") %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  lm_robust(e_math_z ~ reservation_stu + b_math_z + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ fe_var)

lm4 <-
  df_grades %>%
  left_join(df_mp_zscores, by = "stdid") %>% distinct(stdid, e_math_z) %>% summary()
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  lm_robust(e_math_z ~ reservation_stu + b_math_z + female + age + miss_age + father_college + mother_college + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ fe_var)


texreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III", "IV"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for Student Endline Math Test Scores by Student Reservation Status", label = "table:reservationstudent3", digits = 2, include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F, omit.coef = "(fac_*)|(miss_age)", custom.coef.names = c("Reservation student", "Baseline math z-score", "Female student", "Student age", "Father attended college", "Mother attended college"))
```


\newpage

## Table D4: Regressions for Student Endline Physics Test Scores by Student Reservation Status


```{r, results='asis'}
lm1 <-
  df_grades %>%
  left_join(df_mp_zscores, by = "stdid") %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  drop_na(b_physics_z) %>% 
  lm_robust(e_physics_z ~ reservation_stu, data = ., se_type = "stata", fixed_effects = ~ fe_var)

lm2 <-
  df_grades %>%
  left_join(df_mp_zscores, by = "stdid") %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  lm_robust(e_physics_z ~ reservation_stu + b_physics_z, data = ., se_type = "stata", fixed_effects = ~ fe_var)

lm3 <-
  df_grades %>%
  left_join(df_mp_zscores, by = "stdid") %>%
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  lm_robust(e_physics_z ~ reservation_stu + b_physics_z + female + age + miss_age + father_college + mother_college, data = ., se_type = "stata", fixed_effects = ~ fe_var)

lm4 <-
  df_grades %>%
  left_join(df_mp_zscores, by = "stdid") %>% #distinct(stdid, e_physics_z) %>% summary()
  mutate(
    miss_age = if_else(is.na(age), 1L, 0L),
    age = if_else(is.na(age), 0, age)
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>% 
  lm_robust(e_physics_z ~ reservation_stu + b_physics_z + female + age + miss_age + father_college + mother_college + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., se_type = "stata", fixed_effects = ~ fe_var)


texreg(list(lm1, lm2, lm3, lm4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III", "IV"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for Student Endline Physics Test Scores by Student Reservation Status", label = "table:reservationstudent4", digits = 2, include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F, omit.coef = "(fac_*)|(miss_age)", custom.coef.names = c("Reservation student", "Baseline physics z-score", "Female student", "Student age", "Father attended college", "Mother attended college"))
```


\newpage

## Table D5: Variable means by student reservation status (student-course level)

```{r}
temp1 <-
  df_grades %>% 
  drop_na(reservation_stu) %>% 
  count(reservation_stu)

df_grades %>% 
  left_join(df_mp_zscores, by = "stdid") %>% 
  drop_na(reservation_stu) %>%
  group_by(reservation_stu) %>%
  select_if(is.numeric) %>%
  summarize_all(~ mean(., na.rm = T)) %>%
  select(sort(current_vars())) %>% 
  left_join(temp1, by = "reservation_stu") %>%
  select(
    reservation_stu, course_grade = course_rank, age, baseline_math_z_score = b_math_z, endline_math_z_score = e_math_z, baseline_physics_z_score = b_physics_z, endline_physics_z_score = e_physics_z, father_attended_college = father_college, mother_attended_college = mother_college, age, female, rural, 
    faculty_reservation = fac_reservation, faculty_total_publications = fac_publications, faculty_international_publications = efac_pub_intl,  faculty_age = fac_age, faculty_assistant_professor = fac_assistant_professor, faculty_associate_professor = fac_associate_professor, faculty_professor = fac_professor, faculty_degree_college_elite = fac_degree_college_elite, faculty_female = fac_female, faculty_fulltime = fac_fulltime, faculty_highest_degree_phd = fac_highest_degree_phd, faculty_highest_degree_phd_in_progress = fac_highest_degree_phd_in_prog, faculty_highest_degree_masters = fac_highest_degree_masters, faculty_experience_in_years = fac_yearsinhighed,
    n
  ) %>% 
  clean_names(case = "title") %>% 
  pivot_longer(cols = -`Reservation Stu`) %>% 
  pivot_wider(names_from = `Reservation Stu`, values_from = value) %>% 
  mutate_if(is.numeric, ~ round(., 2)) %>% 
  mutate_if(is.numeric, ~ as.character(.)) %>%
  select(`Variable` = name, `Reservation Students` = `1`, `Non-reservation Students` = `0`) %>%
  knitr::kable(booktabs = T)
```


\newpage

## Table D6: Variable means by student reservation status (student level)

```{r}
temp2 <-
  df_grades %>% 
  drop_na(reservation_stu) %>% 
  distinct(stdid, .keep_all = T) %>% 
  count(reservation_stu)

df_grades %>% 
  left_join(df_mp_zscores, by = "stdid") %>% 
  drop_na(reservation_stu) %>%
  distinct(stdid, .keep_all = T) %>% 
  group_by(reservation_stu) %>%
  select_if(is.numeric) %>%
  summarize_all(~ mean(., na.rm = T)) %>%
  select(sort(current_vars())) %>% 
  left_join(temp2, by = "reservation_stu") %>%
  select(
    reservation_stu, course_grade = course_rank, age, baseline_math_z_score = b_math_z, endline_math_z_score = e_math_z, baseline_physics_z_score = b_physics_z, endline_physics_z_score = e_physics_z, father_attended_college = father_college, mother_attended_college = mother_college, age, female, rural, 
    faculty_reservation = fac_reservation, faculty_total_publications = fac_publications, faculty_international_publications = efac_pub_intl,  faculty_age = fac_age, faculty_assistant_professor = fac_assistant_professor, faculty_associate_professor = fac_associate_professor, faculty_professor = fac_professor, faculty_degree_college_elite = fac_degree_college_elite, faculty_female = fac_female, faculty_fulltime = fac_fulltime, faculty_highest_degree_phd = fac_highest_degree_phd, faculty_highest_degree_phd_in_progress = fac_highest_degree_phd_in_prog, faculty_highest_degree_masters = fac_highest_degree_masters, faculty_experience_in_years = fac_yearsinhighed,
    n
  ) %>% 
  clean_names(case = "title") %>% 
  pivot_longer(cols = -`Reservation Stu`) %>% 
  pivot_wider(names_from = `Reservation Stu`, values_from = value) %>% 
  mutate_if(is.numeric, ~ round(., 2)) %>%
  mutate_if(is.numeric, ~ as.character(.)) %>%
  select(`Variable` = name, `Reservation Students` = `1`, `Non-reservation Students` = `0`) %>%
  knitr::kable(booktabs = T)
```

\newpage

# Regressions for student course grades on mechanisms

## Regressions for student course grades on Weekly Hours Spent on Various Teaching-Related Activities


```{r, results='asis', eval=F}
lm_hours2 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female + weekly_hours_advising_students, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_hours3 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ weekly_hours_course + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_hours6 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ weekly_hours_lessons_planning + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_hours9 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ weekly_hours_teaching_class + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_hours11 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ weekly_hours_tutoring + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)


knitreg(list(lm_hours2, lm_hours3, lm_hours6, lm_hours9, lm_hours11), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for student course grades on Weekly Hours Spent on Various Teaching-Related Activities", digits = 2, custom.model.names = c("I", "II", "III", "IV", "V"), include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F, custom.coef.names = c("Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female", "Advising students", "Course related work", "Lesson planning", "Teaching class", "Tutoring"))
```

```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} & \multicolumn{1}{c}{V} \\
\midrule
Advising students                 & 0.15       &            &            &            &            \\
                                  & (0.10)     &            &            &            &            \\
Course related work               &            & -0.03      &            &            &            \\
                                  &            & (0.05)     &            &            &            \\
Lesson planning                   &            &            & -0.01      &            &            \\
                                  &            &            & (0.04)     &            &            \\
Teaching class                    &            &            &            & 0.01       &            \\
                                  &            &            &            & (0.03)     &            \\
Tutoring                          &            &            &            &            & 0.04       \\
                                  &            &            &            &            & (0.13)     \\
Associate professor               & 1.43^{*}   & 1.33       & 1.41^{*}   & 1.41^{*}   & 1.40^{*}   \\
                                  & (0.82)     & (0.88)     & (0.84)     & (0.83)     & (0.84)     \\
Professor                         & 3.34^{**}  & 3.21^{**}  & 3.20^{**}  & 3.24^{**}  & 3.23^{**}  \\
                                  & (1.35)     & (1.38)     & (1.36)     & (1.38)     & (1.37)     \\
Experience in years               & -0.02      & -0.02      & -0.02      & -0.02      & -0.02      \\
                                  & (0.05)     & (0.05)     & (0.05)     & (0.05)     & (0.05)     \\
Highest degree is PhD             & -2.96^{**} & -2.73^{**} & -2.84^{**} & -2.85^{**} & -2.86^{**} \\
                                  & (1.20)     & (1.26)     & (1.21)     & (1.22)     & (1.22)     \\
Highest degree is PhD in progress & -1.12      & -1.03      & -1.02      & -1.03      & -1.03      \\
                                  & (0.85)     & (0.84)     & (0.84)     & (0.84)     & (0.86)     \\
Degree college elite              & 0.25       & 0.14       & 0.20       & 0.21       & 0.22       \\
                                  & (0.58)     & (0.61)     & (0.58)     & (0.59)     & (0.60)     \\
Female                            & 1.09^{*}   & 1.03^{*}   & 1.05^{*}   & 1.07^{*}   & 1.06^{*}   \\
                                  & (0.59)     & (0.60)     & (0.58)     & (0.59)     & (0.59)     \\
\midrule
Num. obs.                         & 37433      & 37535      & 37535      & 37535      & 37535      \\
\bottomrule
\multicolumn{6}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{Regressions for student course grades on Weekly Hours Spent on Various Teaching-Related Activities}
\label{table:coefficients}
\end{center}
\end{table}
```


Notes:

1. The dependent variable is the student course grade measured as the percentile rank in the course (1-100 scale).
2. Grades are provided at the course level and not at the faculty-taught section level.
3. All models control for course fixed effects and student fixed effects. Standard errors are clustered at the faculty level.



\newpage


## Regressions for student course grades on Use of Teaching Practices Inventory Measures


```{r, results='asis', eval=F}
lm_tpi1 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ tpi_score3 + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_tpi2 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ tpi_score4 + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_tpi3 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ tpi_score5 + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_tpi4 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ tpi_score8 + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm_tpi1, lm_tpi2, lm_tpi3, lm_tpi4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for student course grades on Use of Teaching Practices Inventory Measures", digits = 2, custom.model.names = c("I", "II", "III", "IV"), custom.coef.names = c("In-class features and activities", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female", "Assignments", "Feedback and testing", "Collaboration"), include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F)
```


```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} \\
\midrule
In-class features and activities  & -0.12      &            &            &            \\
                                  & (0.11)     &            &            &            \\
Assignments                       &            & -0.04      &            &            \\
                                  &            & (0.14)     &            &            \\
Feedback and testing              &            &            & -0.07      &            \\
                                  &            &            & (0.09)     &            \\
Collaboration                     &            &            &            & 0.41^{**}  \\
                                  &            &            &            & (0.19)     \\
Associate professor               & 1.42^{*}   & 1.42^{*}   & 1.44^{*}   & 1.49^{*}   \\
                                  & (0.85)     & (0.83)     & (0.84)     & (0.85)     \\
Professor                         & 3.32^{**}  & 3.23^{**}  & 3.31^{**}  & 3.27^{**}  \\
                                  & (1.38)     & (1.37)     & (1.36)     & (1.36)     \\
Experience in years               & -0.02      & -0.02      & -0.02      & -0.04      \\
                                  & (0.05)     & (0.05)     & (0.05)     & (0.05)     \\
Highest degree is PhD             & -2.87^{**} & -2.86^{**} & -2.89^{**} & -2.74^{**} \\
                                  & (1.21)     & (1.21)     & (1.22)     & (1.21)     \\
Highest degree is PhD in progress & -0.88      & -1.02      & -0.92      & -1.14      \\
                                  & (0.81)     & (0.84)     & (0.84)     & (0.85)     \\
Degree college elite              & 0.18       & 0.23       & 0.18       & 0.21       \\
                                  & (0.58)     & (0.58)     & (0.59)     & (0.59)     \\
Female                            & 0.94^{*}   & 1.09^{*}   & 1.07^{*}   & 0.97       \\
                                  & (0.56)     & (0.59)     & (0.59)     & (0.59)     \\
\midrule
Num. obs.                         & 37716      & 37716      & 37716      & 37716      \\
\bottomrule
\multicolumn{5}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{Regressions for student course grades on Use of Teaching Practices Inventory Measures}
\label{table:coefficients}
\end{center}
\end{table}
```


Notes:

1. The dependent variable is the student course grade measured as the percentile rank in the course (1-100 scale).
2. Grades are provided at the course level and not at the faculty-taught section level.
3. All models control for course fixed effects and student fixed effects. Standard errors are clustered at the faculty level.

\newpage


## Regressions for student course grades on Total Number of Publications per Year

```{r, results='asis'}
lm_pub1 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>% 
  mutate(fac_publications = fac_publications/3,
         fac_publications = if_else(fac_publications > 30, 30, fac_publications)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_publications, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub2 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>%
  mutate(fac_publications = fac_publications/3,
         fac_publications = if_else(fac_publications > 30, 30, fac_publications)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_publications + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub3 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>% 
  mutate(fac_publications = fac_publications/3,
         fac_publications = if_else(fac_publications > 30, 30, fac_publications)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_publications + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub4 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>% 
  mutate(fac_publications = fac_publications/3,
         fac_publications = if_else(fac_publications > 30, 30, fac_publications)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_publications + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for student course grades on Total Number of Publications per Year", digits = 2, custom.model.names = c("I", "II", "III", "IV"), include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F, custom.coef.names = c("Publications", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```


Notes:

1. The dependent variable is the student course grade measured as the percentile rank in the course (1-100 scale).
2. Grades are provided at the course level and not at the faculty-taught section level.
3. All models control for course fixed effects and student fixed effects. Standard errors are clustered at the faculty level.

\newpage


## Regressions for student course grades on Total Number of International Publications per Year


```{r, results='asis'}
lm_pub1 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(efac_pub_intl = efac_pub_intl/3,
         efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ efac_pub_intl, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub2 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(efac_pub_intl = efac_pub_intl/3,
         efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ efac_pub_intl + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub3 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(efac_pub_intl = efac_pub_intl/3,
         efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ efac_pub_intl + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub4 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(efac_pub_intl = efac_pub_intl/3,
         efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ efac_pub_intl + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for student course grades on Total Number of International Publications per Year", digits = 2, custom.model.names = c("I", "II", "III", "IV"), include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F, custom.coef.names = c("International Publications", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```

Notes:

1. The dependent variable is the student course grade measured as the percentile rank in the course (1-100 scale).
2. Grades are provided at the course level and not at the faculty-taught section level.
3. All models control for course fixed effects and student fixed effects. Standard errors are clustered at the faculty level.

\newpage

## Regressions of student course grades on Proportion of Time Spent on Research


```{r, results='asis'}
lm_pub1 <-
  df_mechanism %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_prop_research, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub2 <-
  df_mechanism %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_prop_research + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub3 <-
  df_mechanism %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_prop_research + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub4 <-
  df_mechanism %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_prop_research + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

knitreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions of student course grades on Proportion of Time Spent on Research", digits = 2, custom.model.names = c("I", "II", "III", "IV"), include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F, custom.coef.names = c("Proportion of time on research", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```

Notes:

1. The dependent variable is the student course grade measured as the percentile rank in the course (1-100 scale).
2. Grades are provided at the course level and not at the faculty-taught section level.
3. All models control for course fixed effects and student fixed effects. Standard errors are clustered at the faculty level.

\newpage





# Regressions for student course grades on Reservation Faculty vs. General Category Faculty and mechanisms

## Regressions for student course grades on Reservation Faculty vs. General Category Faculty and Weekly Hours Spent on Various Teaching-Related Activities

```{r, results='asis', eval=F}
lm_hours1 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female + weekly_hours_advising_students, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_hours2 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ weekly_hours_course + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_hours3 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ weekly_hours_lessons_planning + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_hours4 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ weekly_hours_teaching_class + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_hours5 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ weekly_hours_tutoring + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm_hours1, lm_hours2, lm_hours3, lm_hours4, lm_hours5), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for student course grades on Reservation Faculty vs. General Category Faculty and Weekly Hours Spent on Various Teaching-Related Activities", digits = 2, custom.model.names = c("I", "II", "III", "IV", "V"), include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F, custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female", "Advising students", "Course related work", "Lesson planning", "Teaching class", "Tutoring"))
```


```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{5.5} D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} & \multicolumn{1}{c}{V} \\
\midrule
Advising students                 & 0.16^{*}   &            &            &            &            \\
                                  & (0.10)     &            &            &            &            \\
Course related work               &            & -0.03      &            &            &            \\
                                  &            & (0.05)     &            &            &            \\
Lesson planning                   &            &            & -0.01      &            &            \\
                                  &            &            & (0.04)     &            &            \\
Teaching class                    &            &            &            & 0.02       &            \\
                                  &            &            &            & (0.03)     &            \\
Tutoring                          &            &            &            &            & 0.04       \\
                                  &            &            &            &            & (0.13)     \\
Reservation faculty               & 1.48^{***} & 1.34^{**}  & 1.34^{**}  & 1.34^{**}  & 1.34^{**}  \\
                                  & (0.56)     & (0.56)     & (0.56)     & (0.56)     & (0.56)     \\
Associate professor               & 1.28       & 1.19       & 1.27       & 1.27       & 1.26       \\
                                  & (0.80)     & (0.85)     & (0.82)     & (0.82)     & (0.82)     \\
Professor                         & 3.29^{**}  & 3.15^{**}  & 3.15^{**}  & 3.19^{**}  & 3.18^{**}  \\
                                  & (1.29)     & (1.33)     & (1.30)     & (1.32)     & (1.31)     \\
Experience in years               & -0.02      & -0.01      & -0.02      & -0.02      & -0.01      \\
                                  & (0.05)     & (0.05)     & (0.05)     & (0.05)     & (0.05)     \\
Highest degree is PhD             & -2.64^{**} & -2.43^{**} & -2.55^{**} & -2.55^{**} & -2.57^{**} \\
                                  & (1.15)     & (1.21)     & (1.17)     & (1.17)     & (1.17)     \\
Highest degree is PhD in progress & -1.03      & -0.94      & -0.94      & -0.95      & -0.95      \\
                                  & (0.82)     & (0.81)     & (0.81)     & (0.82)     & (0.83)     \\
Degree college elite              & 0.36       & 0.24       & 0.29       & 0.30       & 0.32       \\
                                  & (0.59)     & (0.61)     & (0.59)     & (0.59)     & (0.60)     \\
Female                            & 1.11^{**}  & 1.04^{*}   & 1.06^{*}   & 1.07^{*}   & 1.06^{*}   \\
                                  & (0.56)     & (0.57)     & (0.56)     & (0.57)     & (0.57)     \\
\midrule
Num. obs.                         & 37433      & 37535      & 37535      & 37535      & 37535      \\
\bottomrule
\multicolumn{6}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{Regressions for student course grades on Reservation Faculty vs. General Category Faculty and Weekly Hours Spent on Various Teaching-Related Activities}
\label{table:coefficients}
\end{center}
\end{table}
```

Notes:

1. The dependent variable is the student course grade measured as the percentile rank in the course (1-100 scale).
2. Grades are provided at the course level and not at the faculty-taught section level.
3. All models control for course fixed effects and student fixed effects. Standard errors are clustered at the faculty level.

\newpage

## Regressions for student course grades on Reservation Faculty vs. General Category Faculty and Use of Teaching Practices Inventory Measures

```{r, results='asis', eval=F}
lm_tpi1 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female + tpi_score3, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_tpi2 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ tpi_score4 + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_tpi3 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ tpi_score5 + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_tpi4 <-
  df_mechanism %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ tpi_score8 + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm_tpi1, lm_tpi2, lm_tpi3, lm_tpi4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for student course grades on Reservation Faculty vs. General Category Faculty and Use of Teaching Practices Inventory Measures", digits = 2, custom.model.names = c("I", "II", "III", "IV"), include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F, custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female", "In-class features and activities", "Assignments", "Feedback and testing", "Collaboration"))
```


```{=latex}
\begin{table}[H]
\begin{center}
\begin{tabular}{l D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4} D{.}{.}{5.4}}
\toprule
 & \multicolumn{1}{c}{I} & \multicolumn{1}{c}{II} & \multicolumn{1}{c}{III} & \multicolumn{1}{c}{IV} \\
\midrule
In-class features and activities  & -0.11      &            &            &            \\
                                  & (0.10)     &            &            &            \\
Assignments                       &            & -0.02      &            &            \\
                                  &            & (0.14)     &            &            \\
Feedback and testing              &            &            & -0.07      &            \\
                                  &            &            & (0.09)     &            \\
Collaboration                     &            &            &            & 0.44^{**}  \\
                                  &            &            &            & (0.20)     \\
Reservation faculty               & 1.31^{**}  & 1.33^{**}  & 1.33^{**}  & 1.43^{**}  \\
                                  & (0.56)     & (0.56)     & (0.56)     & (0.56)     \\
Associate professor               & 1.28       & 1.27       & 1.30       & 1.34       \\
                                  & (0.83)     & (0.82)     & (0.82)     & (0.83)     \\
Professor                         & 3.27^{**}  & 3.18^{**}  & 3.25^{**}  & 3.22^{**}  \\
                                  & (1.33)     & (1.32)     & (1.31)     & (1.30)     \\
Experience in years               & -0.01      & -0.01      & -0.01      & -0.03      \\
                                  & (0.05)     & (0.05)     & (0.05)     & (0.05)     \\
Highest degree is PhD             & -2.57^{**} & -2.56^{**} & -2.59^{**} & -2.42^{**} \\
                                  & (1.16)     & (1.16)     & (1.17)     & (1.16)     \\
Highest degree is PhD in progress & -0.81      & -0.94      & -0.85      & -1.06      \\
                                  & (0.79)     & (0.82)     & (0.81)     & (0.82)     \\
Degree college elite              & 0.28       & 0.32       & 0.28       & 0.31       \\
                                  & (0.59)     & (0.59)     & (0.59)     & (0.59)     \\
Female                            & 0.96^{*}   & 1.09^{*}   & 1.08^{*}   & 0.97^{*}   \\
                                  & (0.54)     & (0.57)     & (0.57)     & (0.56)     \\
\midrule
Num. obs.                         & 37716      & 37716      & 37716      & 37716      \\
\bottomrule
\multicolumn{5}{l}{\scriptsize{$^{***}p<0.01$; $^{**}p<0.05$; $^{*}p<0.1$}}
\end{tabular}
\caption{Regressions for student course grades on Reservation Faculty vs. General Category Faculty and Use of Teaching Practices Inventory Measures}
\label{table:coefficients}
\end{center}
\end{table}
```


Notes:

1. The dependent variable is the student course grade measured as the percentile rank in the course (1-100 scale).
2. Grades are provided at the course level and not at the faculty-taught section level.
3. All models control for course fixed effects and student fixed effects. Standard errors are clustered at the faculty level.

\newpage


## Regressions for student course grades on Reservation Faculty vs. General Category Faculty and Total Number of Publications per Year

```{r, results='asis'}
lm_pub1 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>% 
  mutate(fac_publications = fac_publications/3, 
         fac_publications = if_else(fac_publications > 30, 30, fac_publications)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_publications + reservation_fac, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub2 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>% 
  mutate(fac_publications = fac_publications/3, 
         fac_publications = if_else(fac_publications > 30, 30, fac_publications)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_publications + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub3 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>%
  mutate(fac_publications = fac_publications/3, 
         fac_publications = if_else(fac_publications > 30, 30, fac_publications)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_publications + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub4 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications), by = "facid") %>% 
  mutate(fac_publications = fac_publications/3, 
         fac_publications = if_else(fac_publications > 30, 30, fac_publications)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_publications + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for student course grades on Reservation Faculty vs. General Category Faculty and Total Number of Publications per Year", digits = 2, custom.model.names = c("I", "II", "III", "IV"), include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F, custom.coef.names = c("Publications", "Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```


Notes:

1. The dependent variable is the student course grade measured as the percentile rank in the course (1-100 scale).
2. Grades are provided at the course level and not at the faculty-taught section level.
3. All models control for course fixed effects and student fixed effects. Standard errors are clustered at the faculty level.

\newpage

## Regressions for student course grades on Reservation Faculty vs. General Category Faculty and Total Number of International Publications per Year


```{r, results='asis'}
lm_pub1 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(efac_pub_intl = efac_pub_intl/3,
         efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ efac_pub_intl + reservation_fac, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub2 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(efac_pub_intl = efac_pub_intl/3,
         efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ efac_pub_intl + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub3 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(efac_pub_intl = efac_pub_intl/3,
         efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ efac_pub_intl + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub4 <-
  df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, efac_pub_intl), by = "facid") %>% 
  mutate(efac_pub_intl = efac_pub_intl/3,
         efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ efac_pub_intl + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for student course grades on Reservation Faculty vs. General Category Faculty and Total Number of International Publications per Year", digits = 2, custom.model.names = c("I", "II", "III", "IV"), include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F, custom.coef.names = c("International Publications", "Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```


Notes:

1. The dependent variable is the student course grade measured as the percentile rank in the course (1-100 scale).
2. Grades are provided at the course level and not at the faculty-taught section level.
3. All models control for course fixed effects and student fixed effects. Standard errors are clustered at the faculty level.

\newpage


## Regressions of student course grades on Reservation Faculty vs. General Category Faculty and Proportion of Time Spent on Research

```{r, results='asis'}
lm_pub1 <-
  df_mechanism %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_prop_research + reservation_fac, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub2 <-
  df_mechanism %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_prop_research + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub3 <-
  df_mechanism %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_prop_research + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub4 <-
  df_mechanism %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ fac_prop_research + reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

knitreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions of student course grades on Reservation Faculty vs. General Category Faculty and Proportion of Time Spent on Research", digits = 2, custom.model.names = c("I", "II", "III", "IV"), include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F, custom.coef.names = c("Proportion of time on research", "Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```


Notes:

1. The dependent variable is the student course grade measured as the percentile rank in the course (1-100 scale).
2. Grades are provided at the course level and not at the faculty-taught section level.
3. All models control for course fixed effects and student fixed effects. Standard errors are clustered at the faculty level.


---


# Appendix E

## Table 5.1

```{r, results='asis', eval=F}
# old table code
facdata_mentions %>%
  distinct(facid, .keep_all = T) %>% 
  compareGroups(fac_reservation ~ fac_assistant_professor + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_highest_degree_masters + fac_degree_college_elite + fac_female, data = ., include.label = F) %>% 
  createTable(show.all = F)
```


```{r, results='asis', eval=F}
# new table code
facdata_mentions %>%
  distinct(facid, .keep_all = T) %>% 
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  drop_na(fac_reservation) %>%
  group_by(fac_reservation) %>% 
  summarize_at(
    vars(fac_assistant_professor, fac_associate_professor, fac_professor, fac_yearsinhighed, fac_highest_degree_phd, fac_highest_degree_phd_in_prog, fac_highest_degree_masters, degree_college_elite, fac_female), 
    ~ round(weighted.mean(., w = sw_f, na.rm = T), 2)
  ) %>% 
  pivot_longer(cols = -fac_reservation) %>%
  pivot_wider(names_from = fac_reservation, values_from = value) %>% 
  select(name, `1`, `0`)


# diff and SE
facdata_mentions %>%
  distinct(facid, .keep_all = T) %>% 
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>% 
  difference_in_means(fac_female ~ fac_reservation, data = ., weights = sw_f, ci = T) %>%
  tidy() %>% 
  mutate_at(vars(estimate, std.error), ~ round(., 2))
```


\newpage

## Table 6.1

```{r, results='asis', eval=F}
df_stu %>% 
  left_join(df_mp_zscores, by = "stdid") %>% 
  mutate(
    father_college = if_else(father_ed_ind > 3 & !is.na(father_ed_ind), 1L, 0L),
    father_college = if_else(is.na(father_ed_ind), NA_integer_, father_college),
    mother_college = if_else(mother_ed_ind > 3 & !is.na(mother_ed_ind), 1L, 0L),
    mother_college = if_else(is.na(mother_ed_ind), NA_integer_, mother_college),
  ) %>% 
  left_join(read_dta(here::here("data/controls.dta")), by = "stdid") %>%
  select(
    reservation, female, age, father_attended_college = father_college, mother_attended_college = mother_college, b_i_jeemain_score, baseline_math_z_score = b_math_z, baseline_physics_z_score = b_physics_z
  ) %>% 
  mutate_all(~ as.double(.)) %>%
  compareGroups(reservation ~ ., data = ., include.label = F) %>% 
  createTable(show.all = F)
```


```{r, results='asis', eval=F}
# new table code
df_stu %>% 
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  mutate(
    father_college = if_else(father_ed_ind > 3 & !is.na(father_ed_ind), 1L, 0L),
    father_college = if_else(is.na(father_ed_ind), NA_integer_, father_college),
    mother_college = if_else(mother_ed_ind > 3 & !is.na(mother_ed_ind), 1L, 0L),
    mother_college = if_else(is.na(mother_ed_ind), NA_integer_, mother_college),
    baseline_math_z_score = case_when(
      !is.na(b_math_g1_score) ~ datawizard::standardize(b_math_g1_score, weights = sw_f),
      !is.na(b_math_g3_score) ~ datawizard::standardize(b_math_g3_score, weights = sw_f),
      TRUE ~ NA_real_
    ),
    baseline_physics_z_score = case_when(
      !is.na(b_physics_g1_score) ~ datawizard::standardize(b_physics_g1_score, weights = sw_f),
      !is.na(b_physics_g3_score) ~ datawizard::standardize(b_physics_g3_score, weights = sw_f),
      TRUE ~ NA_real_
    ),
  ) %>% 
  left_join(read_dta(here::here("data/controls.dta")), by = "stdid") %>%
  select(
    reservation, female, age, father_attended_college = father_college, mother_attended_college = mother_college, b_i_jeemain_score, baseline_math_z_score, baseline_physics_z_score, sw_f
  ) %>%
  drop_na(reservation) %>% #skimr::skim() %>% as_tibble() %>% transmute(skim_variable, n_present = 20120-n_missing)
  # mutate(sw_f = 1) %>% 
  group_by(reservation) %>%
  summarize_all(~ round(weighted.mean(., w = sw_f, na.rm = T), 2)) %>%
  select(-sw_f) %>% 
  pivot_longer(cols = -reservation) %>%
  pivot_wider(names_from = reservation, values_from = value) %>% 
  select(name, `1`, `0`)


x`# diff and SE
df_stu %>%
  left_join(read_csv("/Users/saurabh/Everything/GitHub/teacher-like-me/data/depweights.csv"), by = "department_id") %>%
  mutate(
    father_college = if_else(father_ed_ind > 3 & !is.na(father_ed_ind), 1L, 0L),
    father_college = if_else(is.na(father_ed_ind), NA_integer_, father_college),
    mother_college = if_else(mother_ed_ind > 3 & !is.na(mother_ed_ind), 1L, 0L),
    mother_college = if_else(is.na(mother_ed_ind), NA_integer_, mother_college),
    baseline_math_z_score = case_when(
      !is.na(b_math_g1_score) ~ datawizard::standardize(b_math_g1_score, weights = sw_f),
      !is.na(b_math_g3_score) ~ datawizard::standardize(b_math_g3_score, weights = sw_f),
      TRUE ~ NA_real_
    ),
    baseline_physics_z_score = case_when(
      !is.na(b_physics_g1_score) ~ datawizard::standardize(b_physics_g1_score, weights = sw_f),
      !is.na(b_physics_g3_score) ~ datawizard::standardize(b_physics_g3_score, weights = sw_f),
      TRUE ~ NA_real_
    ),
  ) %>% 
  left_join(read_dta(here::here("data/controls.dta")), by = "stdid") %>%
  select(
    reservation, female, age, father_attended_college = father_college, mother_attended_college = mother_college, b_i_jeemain_score, baseline_math_z_score, baseline_physics_z_score, sw_f
  ) %>%
  drop_na(reservation) %>%
  difference_in_means(baseline_physics_z_score ~ reservation, data = ., weights = sw_f, ci = T) %>%
  tidy() %>% 
  mutate_at(vars(estimate, std.error), ~ round(., 2))
```



```{r, eval=F}
# standard errors of difference in means
round(sqrt((1.33 ^2 / 9618) + (1.10 ^2 / 10499)), 2)
```

```{r}
df_stu %>% 
  left_join(df_mp_zscores, by = "stdid") %>% 
  mutate(
    father_college = if_else(father_ed_ind > 3 & !is.na(father_ed_ind), 1L, 0L),
    father_college = if_else(is.na(father_ed_ind), NA_integer_, father_college),
    mother_college = if_else(mother_ed_ind > 3 & !is.na(mother_ed_ind), 1L, 0L),
    mother_college = if_else(is.na(mother_ed_ind), NA_integer_, mother_college),
  ) %>% 
  left_join(read_dta(here::here("data/controls.dta")), by = "stdid") %>%
  select(
    reservation, female, age, father_attended_college = father_college, mother_attended_college = mother_college, b_i_jeemain_score, baseline_math_z_score = b_math_z, baseline_physics_z_score = b_physics_z
  ) %>% 
  mutate_all(~ as.double(.)) %>%
  drop_na(baseline_physics_z_score) %>% 
  count(reservation)
```


# Appendix H (Causal Mediation Analysis)


```{r, eval=F}
# export data

df_mechanism %>% 
  left_join(read_dta(here::here("data/fac_covariates.dta")) %>% select(facid, fac_publications, efac_pub_intl), by = "facid") %>% 
  mutate(efac_pub_intl = if_else(efac_pub_intl > 30, 30, efac_pub_intl)) %>%
  mutate(fac_publications = if_else(fac_publications > 30, 30, fac_publications)) %>%
  select(course_rank, reservation_fac, fac_associate_professor, fac_professor, fac_yearsinhighed, fac_highest_degree_phd, fac_highest_degree_phd_in_prog, fac_degree_college_elite, fac_female, weekly_hours_advising_students, weekly_hours_course, weekly_hours_lessons_planning, weekly_hours_teaching_class, weekly_hours_tutoring, tpi_in_class_activities = tpi_score3, tpi_assignments = tpi_score4, tpi_feedback_testing = tpi_score5, tpi_collaboration_among_teachers = tpi_score8, total_publications = fac_publications, international_publications = efac_pub_intl, prop_time_research = fac_prop_research) %>% 
  write_dta(here::here("data/mediation_analysis.dta"))
```

# Rough Tables

Without stufix effects but student controls:

```{r, results='asis', eval=F}
lm1.2a <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + female + age + father_college + mother_college, data = ., fixed_effects = ~ fe_var, se_type = "stata", clusters = facid)

lm1.2b <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + female + age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ fe_var, se_type = "stata", clusters = facid)

lm1.2c <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + female + age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ fe_var, se_type = "stata", clusters = facid)

lm1.2d <-
  df_grades %>%
  # filter(elite == 0) %>% 
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac + female + age + father_college + mother_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ fe_var, se_type = "stata", clusters = facid)


knitreg(list(lm1.2a, lm1.2b, lm1.2c, lm1.2d), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III", "IV"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, custom.coef.names = c("Reservation faculty", "Student: Female", "Student: Age", "Student: Father college", "Student: Mother college", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"))
```


Heterogeneity by parents' education:

```{r, results='asis', eval=F}
lm1.2a <-
  df_grades %>%
  mutate(
    parent_college = if_else(father_college == 1, 1L, 0L),
    parent_college = if_else(mother_college == 1, 1L, parent_college),
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * parent_college, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm1.2b <-
  df_grades %>%
  mutate(
    parent_college = if_else(father_college == 1, 1L, 0L),
    parent_college = if_else(mother_college == 1, 1L, parent_college),
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * parent_college + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm1.2c <-
  df_grades %>%
  mutate(
    parent_college = if_else(father_college == 1, 1L, 0L),
    parent_college = if_else(mother_college == 1, 1L, parent_college),
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * parent_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm1.2d <-
  df_grades %>%
  mutate(
    parent_college = if_else(father_college == 1, 1L, 0L),
    parent_college = if_else(mother_college == 1, 1L, parent_college),
  ) %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * parent_college + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)


texreg(list(lm1.2a, lm1.2b, lm1.2c, lm1.2d), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III", "IV"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F)
```



Heterogeneity by gender:

```{r, results='asis', eval=F}
lm1.2a <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm1.2b <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * female + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm1.2c <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * female + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm1.2d <-
  df_grades %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(course_rank ~ reservation_fac * female + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)


texreg(list(lm1.2a, lm1.2b, lm1.2c, lm1.2d), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, custom.model.names = c("I", "II", "III", "IV"), dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "", digits = 2, include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F)
```


Funding yes/no:


```{r, results='asis', eval=F}
lm_pub1 <-
  df_mechanism %>% 
  left_join(efac_new_controls %>% select(facid, funding_yesno), by = "facid") %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(funding_yesno ~ reservation_fac, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub2 <-
  df_mechanism %>% 
  left_join(efac_new_controls %>% select(facid, funding_yesno), by = "facid") %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(funding_yesno ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub3 <-
  df_mechanism %>% 
  left_join(efac_new_controls %>% select(facid, funding_yesno), by = "facid") %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(funding_yesno ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub4 <-
  df_mechanism %>% 
  left_join(efac_new_controls %>% select(facid, funding_yesno), by = "facid") %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(funding_yesno ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for Funding Received (Yes/No)", digits = 2, custom.model.names = c("I", "II", "III", "IV"), custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"), include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F)
```


Admin position yes/no:


```{r, results='asis', eval=F}
lm_pub1 <-
  df_mechanism %>% 
  left_join(efac_new_controls %>% select(facid, admin_position_yesno), by = "facid") %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(admin_position_yesno ~ reservation_fac, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub2 <-
  df_mechanism %>% 
  left_join(efac_new_controls %>% select(facid, admin_position_yesno), by = "facid") %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(admin_position_yesno ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub3 <-
  df_mechanism %>% 
  left_join(efac_new_controls %>% select(facid, admin_position_yesno), by = "facid") %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(admin_position_yesno ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

lm_pub4 <-
  df_mechanism %>% 
  left_join(efac_new_controls %>% select(facid, admin_position_yesno), by = "facid") %>%
  mutate(fe_var = str_c(department_id, course_name, sep = "_")) %>%
  lm_robust(admin_position_yesno ~ reservation_fac + fac_associate_professor + fac_professor + fac_yearsinhighed + fac_highest_degree_phd + fac_highest_degree_phd_in_prog + fac_degree_college_elite + fac_female, data = ., fixed_effects = ~ stdid + fe_var, se_type = "stata", clusters = facid)

texreg(list(lm_pub1, lm_pub2, lm_pub3, lm_pub4), custom.note = "%stars", stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, float.pos = "H", caption = "Regressions for Administrative Position Held (Yes/No)", digits = 2, custom.model.names = c("I", "II", "III", "IV"), custom.coef.names = c("Reservation faculty", "Associate professor", "Professor", "Experience in years", "Highest degree is PhD", "Highest degree is PhD in progress", "Degree college elite", "Female"), include.rsquared = F, include.adjrs = F, include.rmse = F, include.nclust = F)
```






